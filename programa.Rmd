---
title: Programa
output:
  html_document:
    toc: true
    css:
      - CSS/logo-above-toc.css
      - CSS/narrow-margins.css
      - CSS/responsive.css
      - CSS/generic.css
      - CSS/main-color.css
---

<!--install and/or load all R packages-->
```{r setup, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', out.width = "100%", results = "hide"}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = 'center',
  results = "asis",
  include = TRUE,
  out.width = "100%",
  knitr.kable.NA = '--',
  knitr.table.format = "html"
)
source("Scripts/all-required-packages.R", local = knitr::knit_global())
```

<!--script for inserting LOGO ABOVE THE TOC-->
```{js}
$(document).ready(function() {
  $('#TOC').parent().prepend('<div id=\"nav_logo\"><img src="PPG/Images/logo-programa.png"></div>');
  });
```

<!--script for sharing-->
<p align="right">
```{r share}
# home <- "https://ppgcr-unisuam.github.io/observatoriocr/"
home <- metadata$repository_url
source("Scripts/social-media-sharing.R", local = knitr::knit_global())
```
</p>

<br>

## **Dados básicos do Programa** {#dados-basicos .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

```{r, eval = !has.apresentacao}
cat('<br>')
```

```{r apresentacao, eval = has.apresentacao}
cat(
  paste0(
    '<iframe src=\"',
    readxl::read_excel("PPG/Apresentação.xlsx", sheet = "Sucupira")[1, 1],
    '\" style=\"width:100%; height:600px; border:2px solid black;\"></iframe>'
  )
)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Breve histórico** {#breve-historico .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

```{r, eval = !has.historico}
cat('<br>')
```

```{r programa-historico, eval = has.historico}
# initialize all sheets
abas <- readxl::excel_sheets("PPG/Histórico.xlsx")

# display each sheet in a tab
for (i in 1:length(abas)) {
  cat('\n\n<!-- -->\n\n')
  cat(paste0('### **', abas[i], '**'))
  cat('\n\n<!-- -->\n\n')
  historico.raw <-
    readxl::read_excel("PPG/Histórico.xlsx",
               sheet = abas[i],
               col_types = c("text"))
  
  # print table
  print(
    kable(historico.raw, align = "l", col.names = NULL) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
  
  cat('\n\n')
  cat('*Fonte:* **PPG**')

  # print end of tab rows
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>

## **Área de avaliação** {#area-avaliacao .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

```{r, eval = !has.area.capes}
cat('<br>')
```

```{r area-capes, eval = has.area.capes}
area.capes <-
  readxl::read_excel("PPG/Área CAPES.xlsx",
             sheet = "CAPES",
             col_types = c("text"))

Abrir <- matrix(NA, nrow = dim(area.capes)[1])
colnames(Abrir) <- "Abrir"
# add hyperlinks
for(i in 1:dim(area.capes)[1]){
  if(!is.na(area.capes[i,2])){
    Abrir[i] <- paste0('<a href="', area.capes[i,2],'" target="_blank"', '>', "↗️" ,"</a>", sep = "")
  }
}
area.capes <- cbind(area.capes[,-2], Abrir)

if (dim(area.capes)[1] != 0) {
  # print tables
  print(
    kable(area.capes, align = c("l", rep(
      "c", ncol(area.capes) - 2
    ), "r"), escape = FALSE) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
} else {
  cat("*Sem dados para exibir*")
}
cat('\n\n')
cat('*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Área de concentração** {#area-concentracao .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

### **Atual**

```{r area-concetracao, eval = has.dados.cadastrais}
area.raw <-
  readxl::read_excel("PPG/Dados Cadastrais.xlsx",
                     sheet = "AC",
                     col_types = c("text"))
area.raw$Fim <- NULL

# print tables
ids <- order(area.raw$'Área de Concentração', decreasing = TRUE)
table <- area.raw[ids, ]

# print tables
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table, title = "Áreas de Concentração")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Inativas**

```{r area-concetracao-inativas, eval = has.dados.cadastrais}
areas.raw <-
  readxl::read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "AC",
             col_types = c("text"))
areas.inativas <- areas.raw[!is.na(areas.raw$Fim),]
areas.inativas <-
  areas.inativas[order(areas.inativas$Fim, decreasing = TRUE),]

# print tables
if (dim(areas.inativas)[1] != 0) {
  print(
    kable(areas.inativas, align = c("l", rep(
      "c", ncol(areas.inativas) - 2
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
} else {
  cat("*Sem dados para exibir*")
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Linhas de pesquisa** {#linha-pesquisa .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

### **Atual**

```{r linhas-de-pesquisa-atual, eval = has.dados.cadastrais}
linhas.raw <-
  readxl::read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "LP",
             col_types = c("text"))
linhas.atual <- linhas.raw[is.na(linhas.raw$Fim),]
linhas.atual$Fim <- NULL

# print tables
ids <- order(linhas.atual$'Linhas de Pesquisa', decreasing = TRUE)
table <- linhas.atual[ids, ]

# print tables
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table, title = "Linhas de Pesquisa")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Inativas**

```{r linhas-de-pesquisa-inativas, eval = has.dados.cadastrais}
linhas.raw <-
  readxl::read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "LP",
             col_types = c("text"))
linhas.inativas <- linhas.raw[!is.na(linhas.raw$Fim),]
linhas.inativas <-
  linhas.inativas[order(linhas.inativas$Fim, decreasing = TRUE),]

# print tables
if (dim(linhas.inativas)[1] != 0) {
  print(
    kable(linhas.inativas, align = c("l", rep(
      "c", ncol(linhas.inativas) - 2
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
} else {
  cat("*Sem dados para exibir*")
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Projetos de pesquisa** {#projeto-pesquisa .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

### **2024-2021** {.tabset}

```{r 2024-2021, eval = has.sucupira.files}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2021:2024), names(sucupira.list)))]
periodos <- as.numeric(periodos)

has.avaliacao <- length(periodos) != 0
```

#### **Lista**

```{r projetos-de-pesquisa-2024-lista, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

table.projetos <-
  data.frame(
    projetos$`Área de Concentração`,
    projetos$`Linha de Pesquisa`,
    projetos$`Nome do Projeto de Pesquisa`,
    projetos$`Nome do Membro do Projeto`
  )
table.projetos <- table.projetos[order(table.projetos[, 1]),]
labels <- colnames(table.projetos)
# print tables
table.projetos[, 1] <-
  as.vector(unlist(lapply(table.projetos[, 1], FUN = str_to_upper)))
table.projetos[, 2] <-
  as.vector(unlist(lapply(table.projetos[, 2], FUN = str_to_sentence)))
table.projetos[, 3] <-
  as.vector(unlist(lapply(table.projetos[, 3], FUN = str_to_title)))

colnames(table.projetos) <-
  c("Área de Concentração",
    "Linha de Pesquisa",
    "Projeto de Pesquisa",
    "Membro Responsável")

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table.projetos, title = "Projetos de Pesquisa - 2024-2021")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Tabela**

```{r projetos-de-pesquisa-2024-tabela, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Docente",]
table.doc <-
  table(projetos.doc$`Nome do Membro do Projeto`,
        projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
print(
  kable(
    table.doc,
    align = c("c", rep("c", ncol(table.doc) - 2), "r"),
    caption = "Docentes"
  ) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  ) %>% scroll_box(width = "100%")
)

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Pós-Doc",]
if (dim(projetos.posdoc)[1] != 0) {
  table.posdoc <-
    table(projetos.posdoc$`Nome do Membro do Projeto`,
          projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  print(
    kable(
      table.posdoc,
      align = c("c", rep("c", ncol(table.posdoc) - 2), "r"),
      caption = "Pós-Doutorandos"
    ) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    ) %>% scroll_box(width = "100%")
  )
  
}

# line break
cat("  \n")
cat("  \n")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Figura**

```{r projetos-de-pesquisa-2024-figura, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Docente",]
table.doc <-
  table(projetos.doc$`Nome do Membro do Projeto`,
        projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Pós-Doc",]
if (length(projetos.posdoc)[1] != 0) {
  table.posdoc <-
    table(projetos.posdoc$`Nome do Membro do Projeto`,
          projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
}

# line break
cat("  \n")
cat("  \n")

# proporção de projetos por linha de pesquisa
layout(matrix(
  c(1, 2, 3, 3),
  nrow = 2,
  ncol = 2,
  byrow = TRUE
), heights = c(0.7, 0.3))
par(oma = c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
levels <- levels[which(levels != "N")]
if (dim(projetos.doc)[1] != 0) {
  pie(
    head(colSums(table.doc), -1),
    labels = NA,
    col = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
    init.angle = 90,
    main = "Docentes"
  )
} else {
  plot(0, type = 'n', axes = FALSE)
}
if (dim(projetos.posdoc)[1] != 0) {
  pie(
    head(colSums(table.posdoc), -1),
    labels = NA,
    col = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
    init.angle = 90,
    main = "Pós-Doutorandos"
  )
} else {
  plot(0, type = 'n', axes = FALSE)
}
plot(0, type = 'n', axes = FALSE)
legend(
  "top",
  inset = 0,
  legend = levels,
  fill = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
  box.lwd = 0,
  cex = 0.7
)
title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2020-2017** {.tabset}

```{r 2020-2017, eval = has.sucupira.files}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2017:2020), names(sucupira.list)))]
periodos <- as.numeric(periodos)

has.avaliacao <- length(periodos) != 0
```

#### **Lista**

```{r projetos-de-pesquisa-2020-lista, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

table.projetos <-
  data.frame(
    projetos$`Área de Concentração`,
    projetos$`Linha de Pesquisa`,
    projetos$`Nome do Projeto de Pesquisa`,
    projetos$`Nome do Membro do Projeto`
  )
table.projetos <- table.projetos[order(table.projetos[, 1]),]
labels <- colnames(table.projetos)
# print tables
table.projetos[, 1] <-
  as.vector(unlist(lapply(table.projetos[, 1], FUN = str_to_upper)))
table.projetos[, 2] <-
  as.vector(unlist(lapply(table.projetos[, 2], FUN = str_to_sentence)))
table.projetos[, 3] <-
  as.vector(unlist(lapply(table.projetos[, 3], FUN = str_to_title)))

colnames(table.projetos) <-
  c("Área de Concentração",
    "Linha de Pesquisa",
    "Projeto de Pesquisa",
    "Membro Responsável")

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table.projetos, title = "Projetos de Pesquisa - 2020-2017")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Tabela**

```{r projetos-de-pesquisa-2020-tabela, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Docente",]
table.doc <-
  table(projetos.doc$`Nome do Membro do Projeto`,
        projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
print(
  kable(
    table.doc,
    align = c("c", rep("c", ncol(table.doc) - 2), "r"),
    caption = "Docentes"
  ) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  ) %>% scroll_box(width = "100%")
)

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Pós-Doc",]
if (dim(projetos.posdoc)[1] != 0) {
  table.posdoc <-
    table(projetos.posdoc$`Nome do Membro do Projeto`,
          projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  print(
    kable(
      table.posdoc,
      align = c("c", rep("c", ncol(table.posdoc) - 2), "r"),
      caption = "Pós-Doutorandos"
    ) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    ) %>% scroll_box(width = "100%")
  )
  
}

# line break
cat("  \n")
cat("  \n")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Figura**

```{r projetos-de-pesquisa-2020-figura, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Docente",]
table.doc <-
  table(projetos.doc$`Nome do Membro do Projeto`,
        projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Pós-Doc",]
if (length(projetos.posdoc)[1] != 0) {
  table.posdoc <-
    table(projetos.posdoc$`Nome do Membro do Projeto`,
          projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
}

# line break
cat("  \n")
cat("  \n")

# proporção de projetos por linha de pesquisa
layout(matrix(
  c(1, 2, 3, 3),
  nrow = 2,
  ncol = 2,
  byrow = TRUE
), heights = c(0.7, 0.3))
par(oma = c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
levels <- levels[which(levels != "N")]
if (dim(projetos.doc)[1] != 0) {
  pie(
    head(colSums(table.doc), -1),
    labels = NA,
    col = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
    init.angle = 90,
    main = "Docentes"
  )
} else {
  plot(0, type = 'n', axes = FALSE)
}
if (dim(projetos.posdoc)[1] != 0) {
  pie(
    head(colSums(table.posdoc), -1),
    labels = NA,
    col = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
    init.angle = 90,
    main = "Pós-Doutorandos"
  )
} else {
  plot(0, type = 'n', axes = FALSE)
}
plot(0, type = 'n', axes = FALSE)
legend(
  "top",
  inset = 0,
  legend = levels,
  fill = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
  box.lwd = 0,
  cex = 0.7
)
title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2016-2013** {.tabset}

```{r 2016-2013, eval = has.sucupira.files}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2013:2016), names(sucupira.list)))]
periodos <- as.numeric(periodos)

has.avaliacao <- length(periodos) != 0
```

#### **Lista**

```{r projetos-de-pesquisa-2016-lista, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

table.projetos <-
  data.frame(
    projetos$`Área de Concentração`,
    projetos$`Linha de Pesquisa`,
    projetos$`Nome do Projeto de Pesquisa`,
    projetos$`Nome do Membro do Projeto`
  )
table.projetos <- table.projetos[order(table.projetos[, 1]),]
labels <- colnames(table.projetos)
# print tables
table.projetos[, 1] <-
  as.vector(unlist(lapply(table.projetos[, 1], FUN = str_to_upper)))
table.projetos[, 2] <-
  as.vector(unlist(lapply(table.projetos[, 2], FUN = str_to_sentence)))
table.projetos[, 3] <-
  as.vector(unlist(lapply(table.projetos[, 3], FUN = str_to_title)))

colnames(table.projetos) <-
  c("Área de Concentração",
    "Linha de Pesquisa",
    "Projeto de Pesquisa",
    "Membro Responsável")

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table.projetos, title = "Projetos de Pesquisa - 2016-2013")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Tabela**

```{r projetos-de-pesquisa-2016-tabela, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Docente",]
table.doc <-
  table(projetos.doc$`Nome do Membro do Projeto`,
        projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
print(
  kable(
    table.doc,
    align = c("c", rep("c", ncol(table.doc) - 2), "r"),
    caption = "Docentes"
  ) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  ) %>% scroll_box(width = "100%")
)

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Pós-Doc",]
if (dim(projetos.posdoc)[1] != 0) {
  table.posdoc <-
    table(projetos.posdoc$`Nome do Membro do Projeto`,
          projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  print(
    kable(
      table.posdoc,
      align = c("c", rep("c", ncol(table.posdoc) - 2), "r"),
      caption = "Pós-Doutorandos"
    ) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    ) %>% scroll_box(width = "100%")
  )
  
}

# line break
cat("  \n")
cat("  \n")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Figura**

```{r projetos-de-pesquisa-2016-figura, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Docente",]
table.doc <-
  table(projetos.doc$`Nome do Membro do Projeto`,
        projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Pós-Doc",]
if (length(projetos.posdoc)[1] != 0) {
  table.posdoc <-
    table(projetos.posdoc$`Nome do Membro do Projeto`,
          projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
}

# line break
cat("  \n")
cat("  \n")

# proporção de projetos por linha de pesquisa
layout(matrix(
  c(1, 2, 3, 3),
  nrow = 2,
  ncol = 2,
  byrow = TRUE
), heights = c(0.7, 0.3))
par(oma = c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
levels <- levels[which(levels != "N")]
if (dim(projetos.doc)[1] != 0) {
  pie(
    head(colSums(table.doc), -1),
    labels = NA,
    col = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
    init.angle = 90,
    main = "Docentes"
  )
} else {
  plot(0, type = 'n', axes = FALSE)
}
if (dim(projetos.posdoc)[1] != 0) {
  pie(
    head(colSums(table.posdoc), -1),
    labels = NA,
    col = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
    init.angle = 90,
    main = "Pós-Doutorandos"
  )
} else {
  plot(0, type = 'n', axes = FALSE)
}
plot(0, type = 'n', axes = FALSE)
legend(
  "top",
  inset = 0,
  legend = levels,
  fill = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
  box.lwd = 0,
  cex = 0.7
)
title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2012-2010** {.tabset}

```{r 2012-2010, eval = has.sucupira.files}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2010:2012), names(sucupira.list)))]
periodos <- as.numeric(periodos)

has.avaliacao <- length(periodos) != 0
```

#### **Lista**

```{r projetos-de-pesquisa-2012-lista, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

table.projetos <-
  data.frame(
    projetos$`Área de Concentração`,
    projetos$`Linha de Pesquisa`,
    projetos$`Nome do Projeto de Pesquisa`,
    projetos$`Nome do Membro do Projeto`
  )
table.projetos <- table.projetos[order(table.projetos[, 1]),]
labels <- colnames(table.projetos)
# print tables
table.projetos[, 1] <-
  as.vector(unlist(lapply(table.projetos[, 1], FUN = str_to_upper)))
table.projetos[, 2] <-
  as.vector(unlist(lapply(table.projetos[, 2], FUN = str_to_sentence)))
table.projetos[, 3] <-
  as.vector(unlist(lapply(table.projetos[, 3], FUN = str_to_title)))

colnames(table.projetos) <-
  c("Área de Concentração",
    "Linha de Pesquisa",
    "Projeto de Pesquisa",
    "Membro Responsável")

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table.projetos, title = "Projetos de Pesquisa - 2012-2010")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Tabela**

```{r projetos-de-pesquisa-2012-tabela, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Docente",]
table.doc <-
  table(projetos.doc$`Nome do Membro do Projeto`,
        projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
print(
  kable(
    table.doc,
    align = c("c", rep("c", ncol(table.doc) - 2), "r"),
    caption = "Docentes"
  ) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  ) %>% scroll_box(width = "100%")
)

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Pós-Doc",]
if (dim(projetos.posdoc)[1] != 0) {
  table.posdoc <-
    table(projetos.posdoc$`Nome do Membro do Projeto`,
          projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  print(
    kable(
      table.posdoc,
      align = c("c", rep("c", ncol(table.posdoc) - 2), "r"),
      caption = "Pós-Doutorandos"
    ) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    ) %>% scroll_box(width = "100%")
  )
  
}

# line break
cat("  \n")
cat("  \n")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Figura**

```{r projetos-de-pesquisa-2012-figura, eval = all(has.sucupira.files, has.avaliacao)}
periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
projetos.all <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])
projetos <-
  projetos.all[projetos.all$`Membro Responsável` == "Sim" &
                 projetos.all$Situação == "EM ANDAMENTO",]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Docente",]
table.doc <-
  table(projetos.doc$`Nome do Membro do Projeto`,
        projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <-
  projetos[projetos$`Categoria do Membro do Projeto` == "Pós-Doc",]
if (length(projetos.posdoc)[1] != 0) {
  table.posdoc <-
    table(projetos.posdoc$`Nome do Membro do Projeto`,
          projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
}

# line break
cat("  \n")
cat("  \n")

# proporção de projetos por linha de pesquisa
layout(matrix(
  c(1, 2, 3, 3),
  nrow = 2,
  ncol = 2,
  byrow = TRUE
), heights = c(0.7, 0.3))
par(oma = c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
levels <- levels[which(levels != "N")]
if (dim(projetos.doc)[1] != 0) {
  pie(
    head(colSums(table.doc), -1),
    labels = NA,
    col = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
    init.angle = 90,
    main = "Docentes"
  )
} else {
  plot(0, type = 'n', axes = FALSE)
}
if (dim(projetos.posdoc)[1] != 0) {
  pie(
    head(colSums(table.posdoc), -1),
    labels = NA,
    col = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
    init.angle = 90,
    main = "Pós-Doutorandos"
  )
} else {
  plot(0, type = 'n', axes = FALSE)
}
plot(0, type = 'n', axes = FALSE)
legend(
  "top",
  inset = 0,
  legend = levels,
  fill = RColorBrewer::brewer.pal(n = length(levels), name = "Set3"),
  box.lwd = 0,
  cex = 0.7
)
title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Agendas de pesquisa** {#agendas-pesquisa .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

<br>

```{r agendas-pesquisa, eval = has.agendas.pesquisa}
# initialize all sheets
abas <- readxl::excel_sheets("PPG/Agendas de Pesquisa.xlsx")

# display each sheet in a tab
for (i in 1:length(abas)) {
  cat('\n\n<!-- -->\n\n')
  cat(paste0('### **', abas[i], '**'))
  cat('\n\n<!-- -->\n\n')
  agendas <-
    readxl::read_excel("PPG/Agendas de Pesquisa.xlsx",
               sheet = abas[i],
               col_types = c("text"))
  
  cat(
    paste(
      '<iframe src="',
      agendas[1],
      '" style=\"width:100%; height:600px; border:2px solid black;"></iframe>',
      sep = ""
    )
  )
  
  # print end of tab rows
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>

## **Financiadores** {#financiadores .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

### **2024-2021**

```{r historico-financiadores-2024, eval = has.financiadores}
# this chunk requires additional data that may  be available
financiadores.raw <-
  readxl::read_excel("PPG/Financiadores.xlsx", sheet = "financiadores")

financiadores.sub <-
  financiadores.raw %>% dplyr::select("Ano",
                               "Agência",
                               "Edital",
                               "Processo No.",
                               "Título do projeto",
                               "Programa")
fonte.sub <- financiadores.raw %>% dplyr::select("Fonte")

financiadores <-
  financiadores.sub[complete.cases(financiadores.sub), ]
fonte <- fonte.sub[complete.cases(financiadores.sub), ]

fonte <-
  fonte[financiadores$Ano >= 2021 & financiadores$Ano <= 2024, ]
financiadores <-
  financiadores[financiadores$Ano >= 2021 &
                  financiadores$Ano <= 2024, ]

if (dim(financiadores)[1] != 0) {
  Abrir <- matrix(NA, nrow = dim(financiadores)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(fonte)[1])
  {
    if (!is.na(fonte[i, 1]))
    {
      Abrir[i] <-
        paste0('<a href="',
               fonte[i, 1],
               '" target="_blank"',
               '>',
               '↗️' ,
               '</a>')
    }
  }
  financiadores <- cbind(financiadores, Abrir)
  financiadores <-
    financiadores[order(financiadores$Ano, decreasing = TRUE), ]
} else {
  cat('\n\n')
  cat('*Sem dados para exibir*')
  cat('\n\n')
}
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
try(create_dt(financiadores, title = "Financiadores - 2024-2021"),
    silent = TRUE)

cat('\n\n')
cat(
  "*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br), [**CNPq**](https://www.gov.br/cnpq/pt-br), [**FAPERJ**](http://www.faperj.br), **UNISUAM**"
)
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2020-2017**

```{r historico-financiadores-2020, eval = has.financiadores}
# this chunk requires additional data that may  be available
financiadores.raw <-
  readxl::read_excel("PPG/Financiadores.xlsx", sheet = "financiadores")

financiadores.sub <-
  financiadores.raw %>% dplyr::select("Ano",
                               "Agência",
                               "Edital",
                               "Processo No.",
                               "Título do projeto",
                               "Programa")
fonte.sub <- financiadores.raw %>% dplyr::select("Fonte")

financiadores <-
  financiadores.sub[complete.cases(financiadores.sub),]
fonte <- fonte.sub[complete.cases(financiadores.sub),]

fonte <-
  fonte[financiadores$Ano >= 2017 & financiadores$Ano <= 2020,]
financiadores <-
  financiadores[financiadores$Ano >= 2017 &
                  financiadores$Ano <= 2020,]

if (dim(financiadores)[1] != 0) {
  Abrir <- matrix(NA, nrow = dim(financiadores)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(fonte)[1])
  {
    if (!is.na(fonte[i, 1]))
    {
      Abrir[i] <-
        paste0('<a href="',
               fonte[i, 1],
               '" target="_blank"',
               '>',
               '↗️' ,
               '</a>')
    }
  }
  financiadores <- cbind(financiadores, Abrir)
  financiadores <-
    financiadores[order(financiadores$Ano, decreasing = TRUE),]
} else {
  cat('\n\n')
  cat('*Sem dados para exibir*')
  cat('\n\n')
}
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
try(create_dt(financiadores, title = "Financiadores - 2020-2017"),
    silent = TRUE)

cat('\n\n')
cat(
  "*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br), [**CNPq**](https://www.gov.br/cnpq/pt-br), [**FAPERJ**](http://www.faperj.br), **UNISUAM**"
)
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2016-2013**

```{r historico-financiadores-2016, eval = has.financiadores}
# this chunk requires additional data that may  be available
financiadores.raw <-
  readxl::read_excel("PPG/Financiadores.xlsx", sheet = "financiadores")

financiadores.sub <-
  financiadores.raw %>% dplyr::select("Ano",
                               "Agência",
                               "Edital",
                               "Processo No.",
                               "Título do projeto",
                               "Programa")
fonte.sub <- financiadores.raw %>% dplyr::select("Fonte")

financiadores <-
  financiadores.sub[complete.cases(financiadores.sub),]
fonte <- fonte.sub[complete.cases(financiadores.sub),]

fonte <-
  fonte[financiadores$Ano >= 2013 & financiadores$Ano <= 2016,]
financiadores <-
  financiadores[financiadores$Ano >= 2013 &
                  financiadores$Ano <= 2016,]

if (dim(financiadores)[1] != 0) {
  Abrir <- matrix(NA, nrow = dim(financiadores)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(fonte)[1])
  {
    if (!is.na(fonte[i, 1]))
    {
      Abrir[i] <-
        paste0('<a href="',
               fonte[i, 1],
               '" target="_blank"',
               '>',
               '↗️' ,
               '</a>')
    }
  }
  financiadores <- cbind(financiadores, Abrir)
  financiadores <-
    financiadores[order(financiadores$Ano, decreasing = TRUE),]
} else {
  cat('\n\n')
  cat('*Sem dados para exibir*')
  cat('\n\n')
}
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
try(create_dt(financiadores, title = "Financiadores - 2016-2013"),
    silent = TRUE)

cat('\n\n')
cat(
  "*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br), [**CNPq**](https://www.gov.br/cnpq/pt-br), [**FAPERJ**](http://www.faperj.br), **UNISUAM**"
)
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2012-2010**

```{r historico-financiadores-2012, eval = has.financiadores}
# this chunk requires additional data that may  be available
financiadores.raw <-
  readxl::read_excel("PPG/Financiadores.xlsx", sheet = "financiadores")

financiadores.sub <-
  financiadores.raw %>% dplyr::select("Ano",
                               "Agência",
                               "Edital",
                               "Processo No.",
                               "Título do projeto",
                               "Programa")
fonte.sub <- financiadores.raw %>% dplyr::select("Fonte")

financiadores <-
  financiadores.sub[complete.cases(financiadores.sub),]
fonte <- fonte.sub[complete.cases(financiadores.sub),]

fonte <-
  fonte[financiadores$Ano >= 2010 & financiadores$Ano <= 2012,]
financiadores <-
  financiadores[financiadores$Ano >= 2010 &
                  financiadores$Ano <= 2012,]

if (dim(financiadores)[1] != 0) {
  Abrir <- matrix(NA, nrow = dim(financiadores)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(fonte)[1])
  {
    if (!is.na(fonte[i, 1]))
    {
      Abrir[i] <-
        paste0('<a href="',
               fonte[i, 1],
               '" target="_blank"',
               '>',
               '↗️' ,
               '</a>')
    }
  }
  financiadores <- cbind(financiadores, Abrir)
  financiadores <-
    financiadores[order(financiadores$Ano, decreasing = TRUE),]
} else {
  cat('\n\n')
  cat('*Sem dados para exibir*')
  cat('\n\n')
}
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
try(create_dt(financiadores, title = "Financiadores - 2012-2010"),
    silent = TRUE)

cat('\n\n')
cat(
  "*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br), [**CNPq**](https://www.gov.br/cnpq/pt-br), [**FAPERJ**](http://www.faperj.br), **UNISUAM**"
)
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Pré-2010**

```{r historico-financiadores-2010, eval = has.financiadores}
# this chunk requires additional data that may  be available
financiadores.raw <-
  readxl::read_excel("PPG/Financiadores.xlsx", sheet = "financiadores")

financiadores.sub <-
  financiadores.raw %>% dplyr::select("Ano",
                               "Agência",
                               "Edital",
                               "Processo No.",
                               "Título do projeto",
                               "Programa")
fonte.sub <- financiadores.raw %>% dplyr::select("Fonte")

financiadores <-
  financiadores.sub[complete.cases(financiadores.sub),]
fonte <- fonte.sub[complete.cases(financiadores.sub),]

fonte <-
  fonte[financiadores$Ano < 2010,]
financiadores <-
  financiadores[financiadores$Ano < 2010,]

if (dim(financiadores)[1] != 0) {
  Abrir <- matrix(NA, nrow = dim(financiadores)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(fonte)[1])
  {
    if (!is.na(fonte[i, 1]))
    {
      Abrir[i] <-
        paste0('<a href="',
               fonte[i, 1],
               '" target="_blank"',
               '>',
               '↗️' ,
               '</a>')
    }
  }
  financiadores <- cbind(financiadores, Abrir)
  financiadores <-
    financiadores[order(financiadores$Ano, decreasing = TRUE),]
} else {
  cat('\n\n')
  cat('*Sem dados para exibir*')
  cat('\n\n')
}
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
try(create_dt(financiadores, title = "Ações durante a Pandemia - Financiadores"),
    silent = TRUE)

cat('\n\n')
cat(
  "*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br), [**CNPq**](https://www.gov.br/cnpq/pt-br), [**FAPERJ**](http://www.faperj.br), **UNISUAM**"
)
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Bolsas de estudo** {#bolsas .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

<br>

```{r bolsas, eval = has.bolsas}
# initialize all sheets
abas <- readxl::excel_sheets("PPG/Bolsas.xlsx")

# display each sheet in a tab
for (j in 1:length(abas)) {
  cat('\n\n<!-- -->\n\n')
  cat(paste0('### **', abas[j], '**'))
  cat('\n\n<!-- -->\n\n')
  bolsas.raw <-
    readxl::read_excel("PPG/Bolsas.xlsx",
                       sheet = abas[j],
                       col_types = c("text"))
  
  # replace the link by a tag
  Abrir <- matrix(NA, nrow = dim(bolsas.raw)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(bolsas.raw)[1]) {
    if (!is.na(bolsas.raw[i, 3])) {
      Abrir[i] <-
        paste0('<a href="',
               bolsas.raw[i, 3],
               '" target="_blank"',
               '>',
               "↗️" ,
               "</a>",
               sep = "")
    }
  }
  bolsas <- cbind(bolsas.raw[, -3], Abrir)
  
  # print table
  if (dim(bolsas)[1] != 0) {
    source("Scripts/table-with-buttons.R", local = knitr::knit_global())
    cat(knitr::knit_print(create_dt(bolsas, title = "Bolsas de estudo")))
  } else {
    cat("*Sem dados para exibir*")
  }
  
  # print end of tab rows
  cat('\n\n')
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>

## **Cursos** {#cursos .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

### **Níveis**

```{r cursos-niveis, eval = has.dados.cadastrais}
# read separate sheets
cursos.raw <-
  readxl::read_excel("PPG/Dados Cadastrais.xlsx",
                     sheet = "Cursos",
                     col_types = c("text"))

cursos <- dplyr::select(cursos.raw, c("Código", "Curso", "Nível"))

# print tables
print(
  kable(cursos, align = c("l", rep("c", ncol(
    cursos
  ) - 2), "r")) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  )
)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Objetivos**

```{r cursos-objetivos, eval = has.dados.cadastrais}
# read separate sheets
cursos.raw <- readxl::read_excel("PPG/Dados Cadastrais.xlsx", sheet = "Cursos", col_types = c("text"))

cursos <- dplyr::select(cursos.raw, c("Nível", "Objetivos"))

# print tables
print(kable(cursos, align = c("l", rep("c", ncol(cursos)-2), "r")) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Créditos**

```{r creditos, eval = has.dados.cadastrais}
# read separate sheets
creditos.raw <-
  readxl::read_excel("PPG/Dados Cadastrais.xlsx",
                     sheet = "Créditos",
                     col_types = c("text"))

# print tables
print(
  kable(creditos.raw, align = c("l", rep(
    "c", ncol(creditos.raw) - 2
  ), "r")) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  )
)
```

```{r estrutura-academica-atual-grafico, eval = has.sucupira.files}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# disciplinas
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# most recent Sucupira year
most.recent <-
  as.character(ifelse(
    !is.null(sucupira.list[[format(Sys.Date(), "%Y")]]),
    format(Sys.Date(), "%Y"),
    max(as.numeric(names(sucupira.list)))
  ))

# read separate sheets
disciplinas.raw <- sucupira.list[[most.recent]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`), ]

# select level
course.level <- "Mestrado"
disciplinas.msc <-
  disciplinas.raw[str_detect(disciplinas.raw$`Nível do Curso`, course.level), ]

table.msc <-
  data.frame(
    disciplinas.msc$`Nome da Disciplina`,
    disciplinas.msc$`Indicadora de disciplina obrigatória`,
    disciplinas.msc$`Quantidade de créditos`,
    disciplinas.msc$`Carga Horária`
  )
try(colnames(table.msc) <-
      c("Disciplina", "Obrigatória", "CR", "CH"),
    silent = TRUE)

# select level
course.level <- "Doutorado"
disciplinas.dsc <-
  disciplinas.raw[str_detect(disciplinas.raw$`Nível do Curso`, course.level), ]
table.dsc <-
  data.frame(
    disciplinas.dsc$`Nome da Disciplina`,
    disciplinas.dsc$`Indicadora de disciplina obrigatória`,
    disciplinas.dsc$`Quantidade de créditos`,
    disciplinas.dsc$`Carga Horária`
  )
try(colnames(table.dsc) <-
      c("Disciplina", "Obrigatória", "CR", "CH"),
    silent = TRUE)

table <-
  merge(table.msc,
        table.dsc,
        by = "Disciplina",
        all.x = TRUE,
        all.y = TRUE)
try(colnames(table) <-
      c(
        "Disciplina",
        "Obrigatória (MA)",
        "CR (MA)",
        "CH (MA)",
        "Obrigatória (DA)",
        "CR (DA)",
        "CH (DA)"
      ),
    silent = TRUE)

if (!is.null(table)) {
  layout(matrix(
    c(1, 2, 3, 3),
    nrow = 2,
    ncol = 2,
    byrow = TRUE
  ), heights = c(0.7, 0.3))
  par(oma = c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
  # generate plot of total per course
  if (dim(table.msc)[1] != 0) {
    pie(
      table(table.msc[, which(colnames(table.msc) == "Obrigatória")]),
      labels = NA,
      col = RColorBrewer::brewer.pal(n = min(unique(
        colnames(table.msc)
      ), 3), name = "Set3"),
      init.angle = 90,
      main = "Mestrado"
    )
  }
  if (dim(table.dsc)[1] != 0) {
    pie(
      table(table.dsc[, which(colnames(table.dsc) == "Obrigatória")]),
      labels = NA,
      col = RColorBrewer::brewer.pal(n = min(unique(
        colnames(table.dsc)
      ), 3), name = "Set3"),
      init.angle = 90,
      main = "Doutorado"
    )
  }
  plot(0, type = 'n', axes = FALSE)
  obrigatoria <-
    unique(disciplinas.raw$`Indicadora de disciplina obrigatória`)
  obrigatoria[which(obrigatoria == "Sim")] <- "Obrigatória"
  obrigatoria[which(obrigatoria == "Não")] <- "Eletiva"
  legend(
    "center",
    legend = obrigatoria,
    fill = RColorBrewer::brewer.pal(n = length(obrigatoria), name = "Set3"),
    box.lwd = 0,
    cex = 1
  )
} else {
  cat("*Sem dados para exibir*")
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Calculadora de créditos (D)** {#calculadora-creditos-d .tabset}

```{r calculadora-creditos, eval = has.dados.cadastrais}
dados.do.programa.raw <-
  readxl::read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "Créditos",
             col_types = c("text"))
colnames(dados.do.programa.raw) <-
  seq(1:dim(dados.do.programa.raw)[2])
```

<center>
  **TOTAL REQUERIDO: `r ifelse(has.dados.cadastrais, dados.do.programa.raw[1,3], "")` CR**
  <br>
  Créditos OBRIGATÓRIOS marcados: <strong id=msgOBRDSC></strong>
  <br>
  Créditos ELETIVOS marcados: <strong id=msgELEDSC></strong>
</center>

#### **Obrigatórios**

<!--script for generating CALCULATOR FORM-->
```{js OBRDSC}
function chkcontrol3(j) {
var sumOBRDSC=0;
for(var i=0; i < document.formOBRDSC.ckb.length; i++){
  if(document.formOBRDSC.ckb[i].checked){
    sumOBRDSC = sumOBRDSC + parseInt(document.formOBRDSC.ckb[i].value);
    }
  document.getElementById("msgOBRDSC").innerHTML= sumOBRDSC + " CR";
  }
}
```

```{r calculadora-doutorado-obrigatorias, eval = has.sucupira.files}
# disciplinas
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# most recent Sucupira year
most.recent <-
  as.character(ifelse(!is.null(sucupira.list[[format(Sys.Date(), "%Y")]]), format(Sys.Date(), "%Y"), max(as.numeric(
    names(sucupira.list)
  ))))

# read separate sheets
disciplinas.raw <- sucupira.list[[most.recent]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]
disciplinas.dsc <-
  disciplinas.raw[which(`dim<-`(grepl('Doutorado', disciplinas.raw$`Nível do Curso`), dim(disciplinas.raw$`Nível do Curso`)), arr.ind = TRUE),]

if (dim(disciplinas.dsc)[1] != 0) {
  table.dsc <-
    data.frame(
      disciplinas.dsc$`Nome da Disciplina`,
      disciplinas.dsc$`Indicadora de disciplina obrigatória`,
      disciplinas.dsc$`Quantidade de créditos`,
      disciplinas.dsc$`Carga Horária`
    )
  colnames(table.dsc) <- c("Disciplina", "Obrigatória", "CR", "CH")
  
  # filtra e exibe apenas as obrigatórias
  table.dsc <- table.dsc[table.dsc[, 2] == "Sim",]
  table.dsc <- table.dsc[complete.cases(table.dsc),]
  table.dsc <- table.dsc[,-2]
  
  cat('<form name=formOBRDSC method=post action=check.php>')
  cat('<table class=\"table table-striped\">')
  for (i in 1:dim(table.dsc)[1]) {
    cat(
      '<tr><td><input type=\"checkbox\" name=\"ckb\" value=\"',
      table.dsc[i, 2],
      '\" onclick=\"chkcontrol3(',
      i - 1,
      ')\">',
      paste0(table.dsc[i, 1], ' (', table.dsc[i, 2], ' CR) (', table.dsc[i, 3]),
      ' CH)',
      '</input></td></tr>'
    )
  }
  cat('</table></form>')
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Eletivos**

<!--script for generating CALCULATOR FORM-->
```{js ELEDSC}
function chkcontrol4(j) {
var sumELEDSC=0;
for(var i=0; i < document.formELEDSC.ckb.length; i++){
  if(document.formELEDSC.ckb[i].checked){
    sumELEDSC = sumELEDSC + parseInt(document.formELEDSC.ckb[i].value);
    }
  document.getElementById("msgELEDSC").innerHTML= sumELEDSC + " CR";
  }
}
```

```{r calculadora-doutorado-eletivas, eval = has.sucupira.files}
# disciplinas
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# most recent Sucupira year
most.recent <-
  as.character(ifelse(!is.null(sucupira.list[[format(Sys.Date(), "%Y")]]), format(Sys.Date(), "%Y"), max(as.numeric(
    names(sucupira.list)
  ))))

# read separate sheets
disciplinas.raw <- sucupira.list[[most.recent]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]
disciplinas.dsc <-
  disciplinas.raw[which(`dim<-`(grepl('Doutorado', disciplinas.raw$`Nível do Curso`), dim(disciplinas.raw$`Nível do Curso`)), arr.ind = TRUE),]

if (dim(disciplinas.dsc)[1] != 0) {
  table.dsc <-
    data.frame(
      disciplinas.dsc$`Nome da Disciplina`,
      disciplinas.dsc$`Indicadora de disciplina obrigatória`,
      disciplinas.dsc$`Quantidade de créditos`,
      disciplinas.dsc$`Carga Horária`
    )
  colnames(table.dsc) <- c("Disciplina", "Eletiva", "CR", "CH")
  
  # filtra e exibe apenas as obrigatórias
  table.dsc <- table.dsc[table.dsc[, 2] == "Não",]
  table.dsc <- table.dsc[complete.cases(table.dsc),]
  table.dsc <- table.dsc[,-2]
  
  cat('<form name=formELEDSC method=post action=check.php>')
  cat('<table class=\"table table-striped\">')
  for (i in 1:dim(table.dsc)[1]) {
    cat(
      '<tr><td><input type=\"checkbox\" name=\"ckb\" value=\"',
      table.dsc[i, 2],
      '\" onclick=\"chkcontrol4(',
      i - 1,
      ')\">',
      paste0(table.dsc[i, 1], ' (', table.dsc[i, 2], ' CR) (', table.dsc[i, 3]),
      ' CH)',
      '</input></td></tr>'
    )
  }
  cat('</table></form>')
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Calculadora de créditos (M)** {#calculadora-creditos-m .tabset}

<center>
  **TOTAL REQUERIDO: `r ifelse(has.dados.cadastrais, dados.do.programa.raw[1,2], "")` CR**
  <br>
  Créditos OBRIGATÓRIOS marcados: <strong id=msgOBRMSC></strong>
  <br>
  Créditos ELETIVOS marcados: <strong id=msgELEMSC></strong>
</center>

#### **Obrigatórios**

<!--script for generating CALCULATOR FORM-->
```{js OBRMSC}
function chkcontrol1(j) {
var sumOBRMSC=0;
for(var i=0; i < document.formOBRMSC.ckb.length; i++){
  if(document.formOBRMSC.ckb[i].checked){
    sumOBRMSC = sumOBRMSC + parseInt(document.formOBRMSC.ckb[i].value);
    }
  document.getElementById("msgOBRMSC").innerHTML= sumOBRMSC + " CR";
  }
}
```

```{r calculadora-mestrado-obrigatorias, eval = has.sucupira.files}
# disciplinas
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# most recent Sucupira year
most.recent <-
  as.character(ifelse(!is.null(sucupira.list[[format(Sys.Date(), "%Y")]]), format(Sys.Date(), "%Y"), max(as.numeric(
    names(sucupira.list)
  ))))

# read separate sheets
disciplinas.raw <- sucupira.list[[most.recent]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]
disciplinas.msc <-
  disciplinas.raw[which(`dim<-`(grepl('Mestrado', disciplinas.raw$`Nível do Curso`), dim(disciplinas.raw$`Nível do Curso`)), arr.ind = TRUE),]

if (dim(disciplinas.msc)[1] != 0) {
  table.msc <-
    data.frame(
      disciplinas.msc$`Nome da Disciplina`,
      disciplinas.msc$`Indicadora de disciplina obrigatória`,
      disciplinas.msc$`Quantidade de créditos`,
      disciplinas.msc$`Carga Horária`
    )
  colnames(table.msc) <- c("Disciplina", "Obrigatória", "CR", "CH")
  
  # filtra e exibe apenas as obrigatórias
  table.msc <- table.msc[table.msc[, 2] == "Sim",]
  table.msc <- table.msc[complete.cases(table.msc),]
  table.msc <- table.msc[,-2]
  
  cat('<form name=formOBRMSC method=post action=check.php>')
  cat('<table class=\"table table-striped\">')
  for (i in 1:dim(table.msc)[1]) {
    cat(
      '<tr><td><input type=\"checkbox\" name=\"ckb\" value=\"',
      table.msc[i, 2],
      '\" onclick=\"chkcontrol1(',
      i - 1,
      ')\">',
      paste0(table.msc[i, 1], ' (', table.msc[i, 2], ' CR) (', table.msc[i, 3]),
      ' CH)',
      '</input></td></tr>'
    )
  }
  cat('</table></form>')
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Eletivos**

<!--script for generating CALCULATOR FORM-->
```{js ELEMSC}
function chkcontrol2(j) {
var sumELEMSC=0;
for(var i=0; i < document.formELEMSC.ckb.length; i++){
  if(document.formELEMSC.ckb[i].checked){
    sumELEMSC = sumELEMSC + parseInt(document.formELEMSC.ckb[i].value);
    }
  document.getElementById("msgELEMSC").innerHTML= sumELEMSC + " CR";
  }
}
```

```{r calculadora-mestrado-eletivas, eval = has.sucupira.files}
# projetos
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# most recent Sucupira year
most.recent <-
  as.character(ifelse(!is.null(sucupira.list[[format(Sys.Date(), "%Y")]]), format(Sys.Date(), "%Y"), max(as.numeric(
    names(sucupira.list)
  ))))

# read separate sheets
disciplinas.raw <- sucupira.list[[most.recent]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]
disciplinas.msc <-
  disciplinas.raw[which(`dim<-`(grepl('Mestrado', disciplinas.raw$`Nível do Curso`), dim(disciplinas.raw$`Nível do Curso`)), arr.ind = TRUE),]

if (dim(disciplinas.msc)[1] != 0) {
  table.msc <-
    data.frame(
      disciplinas.msc$`Nome da Disciplina`,
      disciplinas.msc$`Indicadora de disciplina obrigatória`,
      disciplinas.msc$`Quantidade de créditos`,
      disciplinas.msc$`Carga Horária`
    )
  colnames(table.msc) <- c("Disciplina", "Eletiva", "CR", "CH")
  
  # filtra e exibe apenas as obrigatórias
  table.msc <- table.msc[table.msc[, 2] == "Não",]
  table.msc <- table.msc[complete.cases(table.msc),]
  table.msc <- table.msc[,-2]
  
  cat('<form name=formELEMSC method=post action=check.php>')
  cat('<table class=\"table table-striped\">')
  for (i in 1:dim(table.msc)[1]) {
    cat(
      '<tr><td><input type=\"checkbox\" name=\"ckb\" value=\"',
      table.msc[i, 2],
      '\" onclick=\"chkcontrol2(',
      i - 1,
      ')\">',
      paste0(table.msc[i, 1], ' (', table.msc[i, 2], ' CR) (', table.msc[i, 3]),
      ' CH)',
      '</input></td></tr>'
    )
  }
  cat('</table></form>')
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Estrutura curricular** {#estrutura-curricular .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

### **Disciplinas**

```{r estrutura-academica-atual-tabela, eval = has.sucupira.files}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# projetos
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# most recent Sucupira year
most.recent <-
  as.character(ifelse(
    !is.null(sucupira.list[[format(Sys.Date(), "%Y")]]),
    format(Sys.Date(), "%Y"),
    max(as.numeric(names(sucupira.list)))
  ))

# read separate sheets
disciplinas.raw <- sucupira.list[[most.recent]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`), ]

# select level
course.level <- "Mestrado"
disciplinas.msc <-
  disciplinas.raw[str_detect(disciplinas.raw$`Nível do Curso`, course.level),]
table.msc <-
  data.frame(
    disciplinas.msc$`Nome da Disciplina`,
    disciplinas.msc$`Indicadora de disciplina obrigatória`,
    disciplinas.msc$`Quantidade de créditos`,
    disciplinas.msc$`Carga Horária`
  )
colnames(table.msc) <- c("Disciplina", "Obrigatória", "CR", "CH")

# select level
course.level <- "Doutorado"
disciplinas.dsc <-
  disciplinas.raw[str_detect(disciplinas.raw$`Nível do Curso`, course.level),]
table.dsc <-
  data.frame(
    disciplinas.dsc$`Nome da Disciplina`,
    disciplinas.dsc$`Indicadora de disciplina obrigatória`,
    disciplinas.dsc$`Quantidade de créditos`,
    disciplinas.dsc$`Carga Horária`
  )
colnames(table.dsc) <- c("Disciplina", "Obrigatória", "CR", "CH")

table <-
  merge(table.msc,
        table.dsc,
        by = "Disciplina",
        all.x = TRUE,
        all.y = TRUE)
colnames(table) <-
  c(
    "Disciplina",
    "Obrigatória (MA)",
    "CR (MA)",
    "CH (MA)",
    "Obrigatória (DA)",
    "CR (DA)",
    "CH (DA)"
  )

ids <- order(table$'Disciplina', decreasing = TRUE)
table <- table[ids,]

# print tables
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table, title = "Disciplinas ativas")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Ementas**

```{r ementas, eval = has.bibliografia}
# read separate sheets
bibliografia.raw <-
  readxl::read_excel("PPG/Bibliografia.xlsx",
             sheet = "Ementas",
             col_types = c("text"))
link_ementas <- bibliografia.raw[, 3]

cat(
  '<iframe src=\"',
  as.character(link_ementas),
  '/preview" style=\"width:100%; height:600px; border:0;\"></iframe>',
  sep = ""
)

cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Bibliografia**

```{r bibliografia, eval = has.bibliografia}
# read separate sheets
bibliografia.raw <- readxl::read_excel("PPG/Bibliografia.xlsx", sheet = "Bibliografia", col_types = c("text"))

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(bibliografia.raw, title = "Bibliografia")

cat('<br>')
```

```{r bibliografia-ano, eval = has.bibliografia}
# read separate sheets
bibliografia.raw <- readxl::read_excel("PPG/Bibliografia.xlsx", sheet = "Bibliografia", col_types = c("text"))

bib.ano.raw <- bibliografia.raw$Referência
bib.ano <- as.numeric(na.exclude(str_extract(bib.ano.raw, "[' '][2-2][0-9][0-9][0-9]")))
bib.ano <- as.numeric(na.exclude(str_extract(bib.ano.raw, "[' '][1-1][9-9][5-9][0-9]|[2-2][0-0][0-2][0-1]")))

par(oma=c(2, 0.1, 2, 0.1), mar = c(5, 4, 2, 2))
# generate plot of conceitos per year
hist(bib.ano, xlab = "Ano de publicação", ylab = "Referências (N)", col = RColorBrewer::brewer.pal(n = 3, name = "Set3")[1], main = NULL)
title("Referências bibliográficas, por ano de publicação", outer = TRUE)

cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Inativas**

```{r estrutura-academica-inativa, eval = has.sucupira.files}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# disciplinas
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

disciplinas.raw <- sucupira.raw
disciplinas.raw <-
  disciplinas.raw[!is.na(disciplinas.raw$`Data de fim`),]

disciplinas.msc <-
  disciplinas.raw[which(`dim<-`(
    grepl('Mestrado', disciplinas.raw$`Nível do Curso`),
    dim(disciplinas.raw$`Nível do Curso`)
  ), arr.ind = TRUE), ]
table.msc <-
  cbind(
    disciplinas.msc$`Nome da Disciplina`,
    disciplinas.msc$`Indicadora de disciplina obrigatória`,
    disciplinas.msc$`Quantidade de créditos`,
    disciplinas.msc$`Carga Horária`,
    disciplinas.msc$`Data de fim`
  )
colnames(table.msc) <-
  c("Disciplina", "Obrigatória", "CR", "CH", "Fim")

disciplinas.dsc <-
  disciplinas.raw[which(`dim<-`(
    grepl('Doutorado', disciplinas.raw$`Nível do Curso`),
    dim(disciplinas.raw$`Nível do Curso`)
  ), arr.ind = TRUE), ]
table.dsc <-
  cbind(
    disciplinas.dsc$`Nome da Disciplina`,
    disciplinas.dsc$`Indicadora de disciplina obrigatória`,
    disciplinas.dsc$`Quantidade de créditos`,
    disciplinas.dsc$`Carga Horária`,
    disciplinas.dsc$`Data de fim`
  )
colnames(table.dsc) <-
  c("Disciplina", "Obrigatória", "CR", "CH", "Fim")

table <-
  merge(table.msc,
        table.dsc,
        by = "Disciplina",
        all.x = TRUE,
        all.y = TRUE)
colnames(table) <-
  c(
    "Disciplina",
    "Obrigatória (MA)",
    "CR (MA)",
    "CH (MA)",
    "Fim",
    "Obrigatória (DA)",
    "CR (DA)",
    "CH (DA)",
    "Fim"
  )

ids <- order(table$'Disciplina', decreasing = TRUE)
table <- table[ids, ]

# print tables
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table, title = "Disciplinas inativas")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Turmas** {#turmas .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

### **2024-2021**

```{r turmas-2024-2021, eval = has.sucupira.files}
# turmas
sheet <- "Turmas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# bind all sheets
periodos <-
  names(sucupira.list)[na.omit(match(c(2021:2024), names(sucupira.list)))]

has.avaliacao <- length(periodos) != 0
```

```{r turmas-2024, eval = all(has.sucupira.files, has.avaliacao)}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
turmas.raw <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])

if (dim(turmas.raw)[1] != 0) {
  # build a cross table DISCIPLINA vs. ANO
  turmas.raw$`Período/Ano` <-
    paste(
      sub(".*/", "", turmas.raw$`Período/Ano`),
      sub("/.*", "", turmas.raw$`Período/Ano`),
      sep = "/"
    )
  cross.table.turmas <-
    as.matrix(table(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Período/Ano`
    ))
  Oferecida <- colSums(cross.table.turmas)
  Oferecida[Oferecida > 0] <- "✅"
  Oferecida[Oferecida == 0] <- ""
  turmas.oferecidas <- rbind(Oferecida, cross.table.turmas)
  turmas.oferecidas[turmas.oferecidas > 0] <- "✔"
  turmas.oferecidas[turmas.oferecidas == 0] <- ""
  if (length(colnames(turmas.oferecidas)) > 1) {
    turmas.oferecidas <-
      turmas.oferecidas[, order(colnames(turmas.oferecidas), decreasing = TRUE)]
  }
  print(
    kable(turmas.oferecidas, align = c("l", rep(
      "c",  max(0, ncol(turmas.oferecidas) - 2)
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    ) %>% scroll_box(width = "100%")
  )
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.turma <-
    unique(cbind(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Nome da Disciplina`
    ))
  legenda.turma <- legenda.turma[order(legenda.turma[, 1]),]
  cat(paste(
    "*",
    legenda.turma[, 1],
    ": ",
    lapply(legenda.turma[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2020-2017**

```{r turmas-2020-2017, eval = has.sucupira.files}
# turmas
sheet <- "Turmas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# bind all sheets
periodos <-
  names(sucupira.list)[na.omit(match(c(2017:2020), names(sucupira.list)))]

has.avaliacao <- length(periodos) != 0
```

```{r turmas-2020, eval = all(has.sucupira.files, has.avaliacao)}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
turmas.raw <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])

if (dim(turmas.raw)[1] != 0) {
  # build a cross table DISCIPLINA vs. ANO
  turmas.raw$`Período/Ano` <-
    paste(
      sub(".*/", "", turmas.raw$`Período/Ano`),
      sub("/.*", "", turmas.raw$`Período/Ano`),
      sep = "/"
    )
  cross.table.turmas <-
    as.matrix(table(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Período/Ano`
    ))
  Oferecida <- colSums(cross.table.turmas)
  Oferecida[Oferecida > 0] <- "✅"
  Oferecida[Oferecida == 0] <- ""
  turmas.oferecidas <- rbind(Oferecida, cross.table.turmas)
  turmas.oferecidas[turmas.oferecidas > 0] <- "✔"
  turmas.oferecidas[turmas.oferecidas == 0] <- ""
  if (length(colnames(turmas.oferecidas)) > 1) {
    turmas.oferecidas <-
      turmas.oferecidas[, order(colnames(turmas.oferecidas), decreasing = TRUE)]
  }
  print(
    kable(turmas.oferecidas, align = c("l", rep(
      "c",  max(0, ncol(turmas.oferecidas) - 2)
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    ) %>% scroll_box(width = "100%")
  )
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.turma <-
    unique(cbind(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Nome da Disciplina`
    ))
  legenda.turma <- legenda.turma[order(legenda.turma[, 1]),]
  cat(paste(
    "*",
    legenda.turma[, 1],
    ": ",
    lapply(legenda.turma[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2016-2013**

```{r turmas-2016-2013, eval = has.sucupira.files}
# turmas
sheet <- "Turmas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# bind all sheets
periodos <-
  names(sucupira.list)[na.omit(match(c(2013:2016), names(sucupira.list)))]

has.avaliacao <- length(periodos) != 0
```

```{r turmas-2016, eval = all(has.sucupira.files, has.avaliacao)}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
turmas.raw <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])

if (dim(turmas.raw)[1] != 0) {
  # build a cross table DISCIPLINA vs. ANO
  turmas.raw$`Período/Ano` <-
    paste(
      sub(".*/", "", turmas.raw$`Período/Ano`),
      sub("/.*", "", turmas.raw$`Período/Ano`),
      sep = "/"
    )
  cross.table.turmas <-
    as.matrix(table(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Período/Ano`
    ))
  Oferecida <- colSums(cross.table.turmas)
  Oferecida[Oferecida > 0] <- "✅"
  Oferecida[Oferecida == 0] <- ""
  turmas.oferecidas <- rbind(Oferecida, cross.table.turmas)
  turmas.oferecidas[turmas.oferecidas > 0] <- "✔"
  turmas.oferecidas[turmas.oferecidas == 0] <- ""
  if (length(colnames(turmas.oferecidas)) > 1) {
    turmas.oferecidas <-
      turmas.oferecidas[, order(colnames(turmas.oferecidas), decreasing = TRUE)]
  }
  print(
    kable(turmas.oferecidas, align = c("l", rep(
      "c",  max(0, ncol(turmas.oferecidas) - 2)
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    ) %>% scroll_box(width = "100%")
  )
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.turma <-
    unique(cbind(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Nome da Disciplina`
    ))
  legenda.turma <- legenda.turma[order(legenda.turma[, 1]),]
  cat(paste(
    "*",
    legenda.turma[, 1],
    ": ",
    lapply(legenda.turma[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2012-2010**

```{r turmas-2012-2010, eval = has.sucupira.files}
# turmas
sheet <- "Turmas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# bind all sheets
periodos <-
  names(sucupira.list)[na.omit(match(c(2010:2012), names(sucupira.list)))]

has.avaliacao <- length(periodos) != 0
```

```{r turmas-2012, eval = all(has.sucupira.files, has.avaliacao)}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

periodo <- as.character(seq(min(periodos), max(periodos), by = 1))
turmas.raw <- do.call(rbind.data.frame, sucupira.list[as.character(periodos)])

if (dim(turmas.raw)[1] != 0) {
  # build a cross table DISCIPLINA vs. ANO
  turmas.raw$`Período/Ano` <-
    paste(
      sub(".*/", "", turmas.raw$`Período/Ano`),
      sub("/.*", "", turmas.raw$`Período/Ano`),
      sep = "/"
    )
  cross.table.turmas <-
    as.matrix(table(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Período/Ano`
    ))
  Oferecida <- colSums(cross.table.turmas)
  Oferecida[Oferecida > 0] <- "✅"
  Oferecida[Oferecida == 0] <- ""
  turmas.oferecidas <- rbind(Oferecida, cross.table.turmas)
  turmas.oferecidas[turmas.oferecidas > 0] <- "✔"
  turmas.oferecidas[turmas.oferecidas == 0] <- ""
  if (length(colnames(turmas.oferecidas)) > 1) {
    turmas.oferecidas <-
      turmas.oferecidas[, order(colnames(turmas.oferecidas), decreasing = TRUE)]
  }
  print(
    kable(turmas.oferecidas, align = c("l", rep(
      "c",  max(0, ncol(turmas.oferecidas) - 2)
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    ) %>% scroll_box(width = "100%")
  )
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.turma <-
    unique(cbind(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Nome da Disciplina`
    ))
  legenda.turma <- legenda.turma[order(legenda.turma[, 1]),]
  cat(paste(
    "*",
    legenda.turma[, 1],
    ": ",
    lapply(legenda.turma[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Calendários** {#calendarios .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

### **Sede**

```{r calendarios-sede, eval = has.calendarios}
# read separate sheets
turmas.raw <-
  readxl::read_excel("PPG/Calendários.xlsx",
                     sheet = "Sede",
                     col_types = c("text"))
Abrir <- matrix(NA, nrow = dim(turmas.raw)[1])
colnames(Abrir) <- "Abrir"
# add hyperlinks
for(i in 1:dim(turmas.raw)[1]){
  if(!is.na(turmas.raw[i,3])){
    Abrir[i] <- paste0('<a href="', turmas.raw[i,3],'" target="_blank"', '>', "↗️" ,"</a>", sep = "")
  }
}

turmas <- cbind(turmas.raw[,-3], Abrir)
turmas <- turmas[order(turmas$Publicação, decreasing = TRUE), ]

# print table
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(turmas, title = "Calendários - Sede")

cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Cooperação interinstitucional**

```{r calendarios-cooperacao, eval = has.calendarios}
# read separate sheets
turmas.raw <- readxl::read_excel("PPG/Calendários.xlsx", sheet = "Cooperação Interinstitucional", col_types = c("text"))

Abrir <- matrix(NA, nrow = dim(turmas.raw)[1])
colnames(Abrir) <- "Abrir"
# add hyperlinks
for(i in 1:dim(turmas.raw)[1]){
  if(!is.na(turmas.raw[i,3])){
    Abrir[i] <- paste0('<a href="', turmas.raw[i,3],'" target="_blank"', '>', "↗️" ,"</a>", sep = "")
  }
}

turmas <- cbind(turmas.raw[,-3], Abrir)
turmas <- turmas[order(turmas$Publicação, decreasing = TRUE), ]

# print table
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(turmas, title = "Calendários - Cooperação Interinstitucional")

cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Editais de processo seletivo** {#editais .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

### **Sede**

```{r editais-sede, eval = has.calendarios}
# read separate sheets
editais.raw <- readxl::read_excel("PPG/Editais.xlsx", sheet = "Sede", col_types = c("text"))

Abrir <- matrix(NA, nrow = dim(editais.raw)[1])
colnames(Abrir) <- "Abrir"
# add hyperlinks
for(i in 1:dim(editais.raw)[1]){
  if(!is.na(editais.raw[i,3])){
    Abrir[i] <- paste0('<a href="', editais.raw[i,3],'" target="_blank"', '>', "↗️" ,"</a>", sep = "")
  }
}

editais <- cbind(editais.raw[,-3], Abrir)
editais <- editais[order(editais$Publicação, decreasing = TRUE), ]

# print table
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(editais, title = "Editais - Sede")

cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Cooperação Interinstitucional**

```{r editais-cooperacao, eval = has.calendarios}
# read separate sheets
editais.raw <- readxl::read_excel("PPG/Editais.xlsx", sheet = "Cooperação Interinstitucional", col_types = c("text"))

Abrir <- matrix(NA, nrow = dim(editais.raw)[1])
colnames(Abrir) <- "Abrir"
# add hyperlinks
for(i in 1:dim(editais.raw)[1]){
  if(!is.na(editais.raw[i,3])){
    Abrir[i] <- paste0('<a href="', editais.raw[i,3],'" target="_blank"', '>', "↗️" ,"</a>", sep = "")
  }
}

editais <- cbind(editais.raw[,-3], Abrir)
editais <- editais[order(editais$Publicação, decreasing = TRUE), ]

# print table
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(editais, title = "Editais - Cooperação Interinstitucional")

cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Infraestrutura** {#infraestrutura .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

<br>

```{r infraestrutura, eval = has.infraestrutura}
cat('\n\n<!-- -->\n\n')
cat('### **Infraestrutura**')
cat('\n\n<!-- -->\n\n')

# read separate sheets
infraestrutura <- readxl::read_excel("PPG/Infraestrutura.xlsx", sheet = "Infraestrutura")

# print tables
print(
  kable(infraestrutura, digits = 0, align = c("l", rep(
    "c", ncol(infraestrutura) - 2
  ), "r")) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  ) %>% scroll_box(width = "100%")
)

cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

```{r laboratorios-equipamentos, eval = has.laboratorios}
# read data
abas <- readxl::excel_sheets("PPG/Laboratórios.xlsx")

for (i in 1:length(abas)) {
  lab <-
    readxl::read_excel("PPG/Laboratórios.xlsx",
               sheet = paste("Lab", i, sep = ""))
  name <- names(lab[1])
  
  cat('\n\n<!-- -->\n\n')
  name <- names(lab[1])
  colnames(lab) <- lab[1, ]
  
  cat('\n\n<!-- -->\n\n')
  cat("### **", paste("Lab. ", i, sep = ""), "**", "\n", sep = "")
  cat('\n\n<!-- -->\n\n')
  cat('<center>\n')
  cat("**", name, "**", sep = "")
  cat('\n\n<!-- -->\n\n')
  cat('\n</center>')
  
  cat('<div class = "row"><div class = "col-md-6">')
  cat('<center>\n')
  cat('\n\n<!-- -->\n\n')
  lab <- lab[-1,]
  cat(paste0("![](", getwd(), "/PPG/Labs/Lab-", i, ".jpg)"), "\n")
  cat('\n\n<!-- -->\n\n')
  cat('\n</center>')
  cat('</div>')
  
  cat('<div class = "col-md-6">')
  cat('<center>\n')
  cat('\n\n<!-- -->\n\n')
  print(
    kable(lab, digits = 0, align = c("l", rep("c", ncol(
      lab
    ) - 2), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )  %>% scroll_box(width = "100%", height = "250px")
  )
  cat('\n</center>')
  cat('</div></div>')
  
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>

## **Convênios institucionais** {#convenios .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

<br>

```{r programa-convenios, eval = has.convenios}
# initialize all sheets
abas <- readxl::excel_sheets("PPG/Convênios.xlsx")

# display each sheet in a tab
for (j in 1:length(abas)) {
  cat('\n\n<!-- -->\n\n')
  cat(paste0('### **', abas[j], '**'))
  cat('\n\n<!-- -->\n\n')
  convenios.raw <-
    readxl::read_excel("PPG/Convênios.xlsx",
                       sheet = abas[j],
                       col_types = c("text"))
  
  # replace the link by a tag
  Abrir <- matrix(NA, nrow = dim(convenios.raw)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(convenios.raw)[1]) {
    if (!is.na(convenios.raw[i, 3])) {
      Abrir[i] <-
        paste0('<a href="',
               convenios.raw[i, 3],
               '" target="_blank"',
               '>',
               "↗️" ,
               "</a>",
               sep = "")
    }
  }
  convenios <- cbind(convenios.raw[, -3], Abrir)
  
  # print table
  if (dim(convenios)[1] != 0) {
    source("Scripts/table-with-buttons.R", local = knitr::knit_global())
    cat(knitr::knit_print(create_dt(convenios, title = "Convênios institucionais")))
  } else {
    cat("*Sem dados para exibir*")
  }
  
  # print end of tab rows
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>

## **Cooperação interinstitucional** {#cooperacao .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

<br>

```{r programa-cooperacao, eval = has.cooperacoes}
# initialize all sheets
abas <- readxl::excel_sheets("PPG/Cooperações.xlsx")

# display each sheet in a tab
for (j in 1:length(abas)) {
  cat('\n\n<!-- -->\n\n')
  cat(paste0('### **', abas[j], '**'))
  cat('\n\n<!-- -->\n\n')
  cooperacoes.raw <-
    readxl::read_excel("PPG/Cooperações.xlsx",
                       sheet = abas[j],
                       col_types = c("text"))
  
  # replace the link by a tag
  Abrir <- matrix(NA, nrow = dim(cooperacoes.raw)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(cooperacoes.raw)[1]) {
    if (!is.na(cooperacoes.raw[i, 3])) {
      Abrir[i] <-
        paste0('<a href="',
               cooperacoes.raw[i, 3],
               '" target="_blank"',
               '>',
               "↗️" ,
               "</a>",
               sep = "")
    }
  }
  cooperacoes <- cbind(cooperacoes.raw[, -3], Abrir)
  
  # print table
  if (dim(cooperacoes)[1] != 0) {
    source("Scripts/table-with-buttons.R", local = knitr::knit_global())
    cat(knitr::knit_print(
      create_dt(cooperacoes, title = "Cooperação interinstitucional")
    ))
  } else {
    cat("*Sem dados para exibir*")
  }
  
  # print end of tab rows
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>

## **Internacionalização** {#internacional .tabset}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:black;background-color:black">

<br>

```{r internacional, eval = has.internacionalizacao}
# initialize all sheets
abas <- readxl::excel_sheets("PPG/Internacionalização.xlsx")

# display each sheet in a tab
for (j in 1:length(abas)) {
  cat('\n\n<!-- -->\n\n')
  cat(paste0('### **', abas[j], '**'))
  cat('\n\n<!-- -->\n\n')
  internacional.raw <-
    readxl::read_excel(
      "PPG/Internacionalização.xlsx",
      sheet = abas[j],
      col_types = c("text")
    )
  
  # replace the link by a tag
  Abrir <- matrix(NA, nrow = dim(internacional.raw)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(internacional.raw)[1]) {
    if (!is.na(internacional.raw[i, 3])) {
      Abrir[i] <-
        paste0('<a href="',
               internacional.raw[i, 3],
               '" target="_blank"',
               '>',
               "↗️" ,
               "</a>",
               sep = "")
    }
  }
  internacional <- cbind(internacional.raw[, -3], Abrir)
  
  # print table
  if (dim(internacional)[1] != 0) {
    source("Scripts/table-with-buttons.R", local = knitr::knit_global())
    cat(knitr::knit_print(create_dt(internacional, title = "Internacionalização")))
  } else {
    cat("*Sem dados para exibir*")
  }
  
  # print end of tab rows
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>
