---
title: Programa
output:
  html_document:
    toc: true
    css:
      - CSS/logo-above-toc.css
      - CSS/narrow-margins.css
      - CSS/responsive.css
      - CSS/generic.css
      - CSS/main-color.css
---

<!--install and/or load all R packages-->
```{r setup, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', out.width = "100%", results = "hide"}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = 'center',
  results = "asis",
  include = TRUE,
  out.width = "100%",
  knitr.kable.NA = '--',
  knitr.table.format = "html"
)
source("Scripts/all-required-packages.R", local = knitr::knit_global())
```

<!--script for inserting LOGO ABOVE THE TOC-->
```{js}
$(document).ready(function() {
  $('#TOC').parent().prepend('<div id=\"nav_logo\"><img src="PPG/Images/logo-programa.png"></div>');
  });
```

<!--script for sharing-->
<p align="right">
```{r share}
# home <- "https://ppgcr-unisuam.github.io/observatoriocr/"
home <- metadata$repository_url
source("Scripts/social-media-sharing.R", local = knitr::knit_global())
```
</p>

<br>

## **Apresentação** {.tabset #apresentacao}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **Dados cadastrais**

```{r dados-cadastrais, eval = has.dados.cadastrais}
# read separate sheets
dados.do.programa.raw <-
  read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "Dados do programa",
             col_types = c("text"))
colnames(dados.do.programa.raw) <-
  seq(1:dim(dados.do.programa.raw)[2])

endereco.raw <-
  read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "Endereço",
             col_types = c("text"))
colnames(endereco.raw) <- seq(1:dim(endereco.raw)[2])

# resolve long URLs
for (i in 1:dim(endereco.raw)[1]) {
  if (length(grep("https://", endereco.raw[i, 2])) != 0) {
    endereco.raw[i, 2] <-
      paste('[↗️](', endereco.raw[i, 2], '){target="_blank"}', sep = "")
  }
}

# print tables
table <-
  unname(as.data.frame(rbind(dados.do.programa.raw, endereco.raw)))

print(
  kable(table, align = c("l", rep("c", ncol(
    table
  ) - 2), "r")) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  )
)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Sucupira**

```{r apresentacao, eval = has.apresentacao}
cat(
  paste0(
    '<iframe src=\"',
    read_excel("PPG/Apresentação.xlsx", sheet = "Sucupira")[1,1],
    '\" style=\"width:100%; height:500px; border:2px solid black;\"></iframe>'
  )
)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Breve histórico** {.tabset #breve-historico}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

```{r programa-historico, eval = has.historico}
# initialize all sheets
abas <- excel_sheets("PPG/Histórico.xlsx")

# display each sheet in a tab
for (i in 1:length(abas)) {
  cat('\n\n<!-- -->\n\n')
  cat(paste0('### **', abas[i], '**'))
  cat('\n\n<!-- -->\n\n')
  historico.raw <-
    read_excel("PPG/Histórico.xlsx",
               sheet = abas[i],
               col_types = c("text"))
  
  # print table
  print(
    kable(historico.raw, align = "l", col.names = NULL) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
  
  # print end of tab rows
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>

## **Área de concentração** {.tabset #area-concentracao}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **Atual**

```{r area-concetracao, eval = has.dados.cadastrais}
area.raw <-
  read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "AC",
             col_types = c("text"))
area.raw$Fim <- NULL

# print tables
print(
  kable(area.raw, align = c("l", rep(
    "c", ncol(area.raw) - 2
  ), "r")) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  )
)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Inativas**

```{r area-concetracao-inativas, eval = has.dados.cadastrais}
areas.raw <-
  read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "AC",
             col_types = c("text"))
areas.inativas <- areas.raw[!is.na(areas.raw$Fim),]
areas.inativas <-
  areas.inativas[order(areas.inativas$Fim, decreasing = TRUE),]

# print tables
if (dim(areas.inativas)[1] != 0) {
  print(
    kable(areas.inativas, align = c("l", rep(
      "c", ncol(areas.inativas) - 2
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
} else {
  cat("*Sem dados para exibir*")
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Linhas de pesquisa** {.tabset #linha-pesquisa}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **Atual**

```{r linhas-de-pesquisa-atual, eval = has.dados.cadastrais}
linhas.raw <-
  read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "LP",
             col_types = c("text"))
linhas.atual <- linhas.raw[is.na(linhas.raw$Fim),]
linhas.atual$Fim <- NULL

# print tables
print(
  kable(linhas.atual, align = c("l", rep(
    "c", ncol(linhas.atual) - 2
  ), "r")) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  )
)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Inativas**

```{r linhas-de-pesquisa-inativas, eval = has.dados.cadastrais}
linhas.raw <-
  read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "LP",
             col_types = c("text"))
linhas.inativas <- linhas.raw[!is.na(linhas.raw$Fim),]
linhas.inativas <-
  linhas.inativas[order(linhas.inativas$Fim, decreasing = TRUE),]

# print tables
if (dim(linhas.inativas)[1] != 0) {
  print(
    kable(linhas.inativas, align = c("l", rep(
      "c", ncol(linhas.inativas) - 2
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
} else {
  cat("*Sem dados para exibir*")
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Projetos de pesquisa** {.tabset #projeto-pesquisa}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **2024-2021** {.tabset}

#### **Figura**

```{r projetos-de-pesquisa-2024-grafico, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2021:2024), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "EM ANDAMENTO", ]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <- projetos[projetos$`Categoria do Membro do Projeto` =="Docente", ]
table.doc <- table(projetos.doc$`Nome do Membro do Projeto`, projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
# print(kable(table.doc, align = c("l", rep("c", ncol(table.doc)-2), "r"), caption = "Docentes") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <- projetos[projetos$`Categoria do Membro do Projeto` =="Pós-Doc", ]
if(length(projetos.posdoc)[1] != 0){
  table.posdoc <- table(projetos.posdoc$`Nome do Membro do Projeto`, projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  # print(kable(table.posdoc, align = c("l", rep("c", ncol(table.posdoc)-2), "r"), caption = "Pós-Doutorandos") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))
}

# line break
cat("  \n")
cat("  \n")
  
# proporção de projetos por linha de pesquisa
layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights = c(0.7,0.3))
par(oma=c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
levels <- levels[which(levels != "N")]
pie(head(colSums(table.doc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Docentes")
if(dim(projetos.posdoc)[1] != 0){
  pie(head(colSums(table.posdoc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Pós-Doutorandos")
} else {
  plot(0, type = 'n', axes = FALSE)
}
plot(0, type = 'n', axes = FALSE)
legend("top", inset = 0, legend = levels, fill = brewer.pal(n = length(levels), name = "Set3"), box.lwd = 0, cex = 0.7)
title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Tabela**

```{r projetos-de-pesquisa-2024-tabela, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2021:2024), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "EM ANDAMENTO", ]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <- projetos[projetos$`Categoria do Membro do Projeto` =="Docente", ]
table.doc <- table(projetos.doc$`Nome do Membro do Projeto`, projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
print(kable(table.doc, align = c("c", rep("c", ncol(table.doc)-2), "r"), caption = "Docentes") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <- projetos[projetos$`Categoria do Membro do Projeto` =="Pós-Doc", ]
if(dim(projetos.posdoc)[1] != 0){
  table.posdoc <- table(projetos.posdoc$`Nome do Membro do Projeto`, projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  print(kable(table.posdoc, align = c("c", rep("c", ncol(table.posdoc)-2), "r"), caption = "Pós-Doutorandos") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

}

# line break
cat("  \n")
cat("  \n")
  
# proporção de projetos por linha de pesquisa
# layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights = c(0.7,0.3))
# par(oma=c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
# levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
# levels <- levels[which(levels != "N")]
# pie(head(colSums(table.doc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Docentes")
# if(dim(projetos.posdoc)[1] != 0){
#   pie(head(colSums(table.posdoc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Pós-Doutorandos")
# } else {
#   plot(0, type = 'n', axes = FALSE)
# }
# plot(0, type = 'n', axes = FALSE)
# legend("top", inset = 0, legend = levels, fill = brewer.pal(n = length(levels), name = "Set3"), box.lwd = 0, cex = 1)
# title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Lista**

```{r projetos-de-pesquisa-2024-lista, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2021:2024), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "EM ANDAMENTO", ]
projetos <- unique(projetos)

table.projetos <- cbind(projetos$`Nome do Membro do Projeto`, projetos$`Nome do Projeto de Pesquisa`, projetos$`Linha de Pesquisa`)
table.projetos <- table.projetos[order(table.projetos[, 1]), ]
labels <- colnames(table.projetos)
# print tables
table.projetos[, 1] <- as.vector(unlist(lapply(table.projetos[, 1], FUN = str_to_upper)))
table.projetos[, 2] <- as.vector(unlist(lapply(table.projetos[, 2], FUN = str_to_sentence)))
table.projetos[, 3] <- as.vector(unlist(lapply(table.projetos[, 3], FUN = str_to_title)))

colnames(table.projetos) <- c("Nome do Membro Responsável", "Nome do Projeto de Pesquisa", "Linha de Pesquisa")

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table.projetos, title = "Projetos de Pesquisa 2021-2024")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2020-2017** {.tabset}

#### **Figura**

```{r projetos-de-pesquisa-2020-grafico, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2017:2020), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "CONCLUÍDO", ]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <- projetos[projetos$`Categoria do Membro do Projeto` =="Docente", ]
table.doc <- table(projetos.doc$`Nome do Membro do Projeto`, projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
# print(kable(table.doc, align = c("l", rep("c", ncol(table.doc)-2), "r"), caption = "Docentes") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <- projetos[projetos$`Categoria do Membro do Projeto` =="Pós-Doc", ]
if(dim(projetos.posdoc)[1] != 0){
  table.posdoc <- table(projetos.posdoc$`Nome do Membro do Projeto`, projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  # print(kable(table.posdoc, align = c("l", rep("c", ncol(table.posdoc)-2), "r"), caption = "Pós-Doutorandos") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))
}

# line break
cat("  \n")
cat("  \n")
  
# proporção de projetos por linha de pesquisa
layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights = c(0.7,0.3))
par(oma=c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
levels <- levels[which(levels != "N")]
pie(head(colSums(table.doc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Docentes")
if(dim(projetos.posdoc)[1] != 0){
  pie(head(colSums(table.posdoc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Pós-Doutorandos")
} else {
  plot(0, type = 'n', axes = FALSE)
}
plot(0, type = 'n', axes = FALSE)
legend("top", inset = 0, legend = levels, fill = brewer.pal(n = length(levels), name = "Set3"), box.lwd = 0, cex = 0.7)
title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Tabela**

```{r projetos-de-pesquisa-2020-tabela, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2017:2020), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "CONCLUÍDO", ]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <- projetos[projetos$`Categoria do Membro do Projeto` =="Docente", ]
table.doc <- table(projetos.doc$`Nome do Membro do Projeto`, projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
print(kable(table.doc, align = c("c", rep("c", ncol(table.doc)-2), "r"), caption = "Docentes") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <- projetos[projetos$`Categoria do Membro do Projeto` =="Pós-Doc", ]
if(dim(projetos.posdoc)[1] != 0){
  table.posdoc <- table(projetos.posdoc$`Nome do Membro do Projeto`, projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  print(kable(table.posdoc, align = c("c", rep("c", ncol(table.posdoc)-2), "r"), caption = "Pós-Doutorandos") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

}

# line break
cat("  \n")
cat("  \n")
  
# proporção de projetos por linha de pesquisa
# layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights = c(0.7,0.3))
# par(oma=c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
# levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
# levels <- levels[which(levels != "N")]
# pie(head(colSums(table.doc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Docentes")
# if(dim(projetos.posdoc)[1] != 0){
#   pie(head(colSums(table.posdoc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Pós-Doutorandos")
# } else {
#   plot(0, type = 'n', axes = FALSE)
# }
# plot(0, type = 'n', axes = FALSE)
# legend("top", inset = 0, legend = levels, fill = brewer.pal(n = length(levels), name = "Set3"), box.lwd = 0, cex = 1)
# title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Lista**

```{r projetos-de-pesquisa-2020-lista, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2017:2020), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "CONCLUÍDO", ]
projetos <- unique(projetos)

table.projetos <- cbind(projetos$`Nome do Membro do Projeto`, projetos$`Nome do Projeto de Pesquisa`, projetos$`Linha de Pesquisa`)
table.projetos <- table.projetos[order(table.projetos[, 1]), ]
labels <- colnames(table.projetos)
# print tables
table.projetos[, 1] <- as.vector(unlist(lapply(table.projetos[, 1], FUN = str_to_upper)))
table.projetos[, 2] <- as.vector(unlist(lapply(table.projetos[, 2], FUN = str_to_sentence)))
table.projetos[, 3] <- as.vector(unlist(lapply(table.projetos[, 3], FUN = str_to_title)))

colnames(table.projetos) <- c("Nome do Membro Responsável", "Nome do Projeto de Pesquisa", "Linha de Pesquisa")

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table.projetos, title = "Projetos de Pesquisa 2020-2017")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2016-2013** {.tabset}

#### **Figura**

```{r projetos-de-pesquisa-2016-grafico, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2013:2016), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "CONCLUÍDO", ]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <- projetos[projetos$`Categoria do Membro do Projeto` =="Docente", ]
table.doc <- table(projetos.doc$`Nome do Membro do Projeto`, projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
# print(kable(table.doc, align = c("l", rep("c", ncol(table.doc)-2), "r"), caption = "Docentes") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <- projetos[projetos$`Categoria do Membro do Projeto` =="Pós-Doc", ]
if(dim(projetos.posdoc)[1] != 0){
  table.posdoc <- table(projetos.posdoc$`Nome do Membro do Projeto`, projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  # print(kable(table.posdoc, align = c("l", rep("c", ncol(table.posdoc)-2), "r"), caption = "Pós-Doutorandos") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))
}

# line break
cat("  \n")
cat("  \n")
  
# proporção de projetos por linha de pesquisa
layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights = c(0.7,0.3))
par(oma=c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
levels <- levels[which(levels != "N")]
pie(head(colSums(table.doc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Docentes")
if(dim(projetos.posdoc)[1] != 0){
  pie(head(colSums(table.posdoc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Pós-Doutorandos")
} else {
  plot(0, type = 'n', axes = FALSE)
}
plot(0, type = 'n', axes = FALSE)
legend("top", inset = 0, legend = levels, fill = brewer.pal(n = length(levels), name = "Set3"), box.lwd = 0, cex = 0.7)
title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Tabela**

```{r projetos-de-pesquisa-2016-tabela, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2013:2016), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "CONCLUÍDO", ]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <- projetos[projetos$`Categoria do Membro do Projeto` =="Docente", ]
table.doc <- table(projetos.doc$`Nome do Membro do Projeto`, projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
print(kable(table.doc, align = c("c", rep("c", ncol(table.doc)-2), "r"), caption = "Docentes") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
table.posdoc <- NULL
projetos.posdoc <- projetos[projetos$`Categoria do Membro do Projeto` =="Pós-Doc", ]
if(dim(projetos.posdoc)[1] != 0){
  table.posdoc <- table(projetos.posdoc$`Nome do Membro do Projeto`, projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  print(kable(table.posdoc, align = c("c", rep("c", ncol(table.posdoc)-2), "r"), caption = "Pós-Doutorandos") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

}

# line break
cat("  \n")
cat("  \n")
  
# proporção de projetos por linha de pesquisa
# layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights = c(0.7,0.3))
# par(oma=c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
# levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
# levels <- levels[which(levels != "N")]
# pie(head(colSums(table.doc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Docentes")
# if(dim(projetos.posdoc)[1] != 0){
#   pie(head(colSums(table.posdoc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Pós-Doutorandos")
# } else {
#   plot(0, type = 'n', axes = FALSE)
# }
# plot(0, type = 'n', axes = FALSE)
# legend("top", inset = 0, legend = levels, fill = brewer.pal(n = length(levels), name = "Set3"), box.lwd = 0, cex = 1)
# title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Lista**

```{r projetos-de-pesquisa-2016-lista, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2013:2016), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "CONCLUÍDO", ]
projetos <- unique(projetos)

table.projetos <- cbind(projetos$`Nome do Membro do Projeto`, projetos$`Nome do Projeto de Pesquisa`, projetos$`Linha de Pesquisa`)
table.projetos <- table.projetos[order(table.projetos[, 1]), ]
labels <- colnames(table.projetos)
# print tables
table.projetos[, 1] <- as.vector(unlist(lapply(table.projetos[, 1], FUN = str_to_upper)))
table.projetos[, 2] <- as.vector(unlist(lapply(table.projetos[, 2], FUN = str_to_sentence)))
table.projetos[, 3] <- as.vector(unlist(lapply(table.projetos[, 3], FUN = str_to_title)))

colnames(table.projetos) <- c("Nome do Membro Responsável", "Nome do Projeto de Pesquisa", "Linha de Pesquisa")

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table.projetos, title = "Projetos de Pesquisa 2013-2016")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2012-2010** {.tabset}

#### **Figura**

```{r projetos-de-pesquisa-concluidos-2012-grafico, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2010:2012), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "CONCLUÍDO", ]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <- projetos[projetos$`Categoria do Membro do Projeto` =="Docente", ]
table.doc <- table(projetos.doc$`Nome do Membro do Projeto`, projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
# print(kable(table.doc, align = c("l", rep("c", ncol(table.doc)-2), "r"), caption = "Docentes") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
projetos.posdoc <- projetos[projetos$`Categoria do Membro do Projeto` =="Pós-Doc", ]
if(dim(projetos.posdoc)[1] != 0){
  table.posdoc <- table(projetos.posdoc$`Nome do Membro do Projeto`, projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  # print(kable(table.posdoc, align = c("l", rep("c", ncol(table.posdoc)-2), "r"), caption = "Pós-Doutorandos") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))
}

# line break
cat("  \n")
cat("  \n")
  
# proporção de projetos por linha de pesquisa
layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights = c(0.7,0.3))
par(oma=c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
levels <- levels[which(levels != "N")]
pie(head(colSums(table.doc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Docentes")
if(dim(projetos.posdoc)[1] != 0){
  pie(head(colSums(table.posdoc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Pós-Doutorandos")
} else {
  plot(0, type = 'n', axes = FALSE)
}
plot(0, type = 'n', axes = FALSE)
legend("top", inset = 0, legend = levels, fill = brewer.pal(n = length(levels), name = "Set3"), box.lwd = 0, cex = 0.7)
title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Tabela**

```{r projetos-de-pesquisa-concluidos-2012-tabela, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2010:2012), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "CONCLUÍDO", ]
projetos <- unique(projetos)

# select data DOCENTES
projetos.doc <- projetos[projetos$`Categoria do Membro do Projeto` =="Docente", ]
table.doc <- table(projetos.doc$`Nome do Membro do Projeto`, projetos.doc$`Linha de Pesquisa`)
# add row totals
table.doc <- cbind(table.doc, rowSums(table.doc))
colnames(table.doc) <- c(head(colnames(table.doc), -1), "N")
# add column totals
table.doc <- rbind(table.doc, colSums(table.doc))
rownames(table.doc) <- c(head(rownames(table.doc), -1), "N")
# print tables
print(kable(table.doc, align = c("c", rep("c", ncol(table.doc)-2), "r"), caption = "Docentes") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

# line break
cat("  \n")
cat("  \n")

# select data POS-DOC
projetos.posdoc <- projetos[projetos$`Categoria do Membro do Projeto` =="Pós-Doc", ]
if(dim(projetos.posdoc)[1] != 0){
  table.posdoc <- table(projetos.posdoc$`Nome do Membro do Projeto`, projetos.posdoc$`Linha de Pesquisa`)
  # add row totals
  table.posdoc <- cbind(table.posdoc, rowSums(table.posdoc))
  colnames(table.posdoc) <- c(head(colnames(table.posdoc), -1), "N")
  # add column totals
  table.posdoc <- rbind(table.posdoc, colSums(table.posdoc))
  rownames(table.posdoc) <- c(head(rownames(table.posdoc), -1), "N")
  # print tables
  print(kable(table.posdoc, align = c("c", rep("c", ncol(table.posdoc)-2), "r"), caption = "Pós-Doutorandos") %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

}

# line break
cat("  \n")
cat("  \n")
  
# proporção de projetos por linha de pesquisa
# layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights = c(0.7,0.3))
# par(oma=c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
# levels <- unique(c(colnames(table.doc), colnames(table.posdoc)))
# levels <- levels[which(levels != "N")]
# pie(head(colSums(table.doc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Docentes")
# if(dim(projetos.posdoc)[1] != 0){
#   pie(head(colSums(table.posdoc), -1), labels = NA, col = brewer.pal(n = length(levels), name = "Set3"), init.angle = 90, main = "Pós-Doutorandos")
# } else {
#   plot(0, type = 'n', axes = FALSE)
# }
# plot(0, type = 'n', axes = FALSE)
# legend("top", inset = 0, legend = levels, fill = brewer.pal(n = length(levels), name = "Set3"), box.lwd = 0, cex = 1)
# title("Projetos de Pesquisa", outer = TRUE)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Lista**

```{r projetos-de-pesquisa-2012-lista, eval = has.sucupira}
# projetos - membros
sheet <- "Projetos - Membros"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

periodos <- names(sucupira.list)[na.omit(match(c(2010:2012), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
projetos.all <- do.call(rbind.data.frame, sucupira.list[periodos])
projetos <- projetos.all[projetos.all$`Membro Responsável`=="Sim" & projetos.all$Situação == "CONCLUÍDO", ]
projetos <- unique(projetos)

table.projetos <- cbind(projetos$`Nome do Membro do Projeto`, projetos$`Nome do Projeto de Pesquisa`, projetos$`Linha de Pesquisa`)
table.projetos <- table.projetos[order(table.projetos[, 1]), ]
labels <- colnames(table.projetos)
# print tables
table.projetos[, 1] <- as.vector(unlist(lapply(table.projetos[, 1], FUN = str_to_upper)))
table.projetos[, 2] <- as.vector(unlist(lapply(table.projetos[, 2], FUN = str_to_sentence)))
table.projetos[, 3] <- as.vector(unlist(lapply(table.projetos[, 3], FUN = str_to_title)))

colnames(table.projetos) <- c("Nome do Membro Responsável", "Nome do Projeto de Pesquisa", "Linha de Pesquisa")

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(table.projetos, title = "Projetos de Pesquisa 2010-2012")

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Agendas de pesquisa** {.tabset #agendas-pesquisa}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

```{r agendas-pesquisa, eval = has.agendas.pesquisa}
# initialize all sheets
abas <- excel_sheets("PPG/Agendas de Pesquisa.xlsx")

# display each sheet in a tab
for (i in 1:length(abas)) {
  cat('\n\n<!-- -->\n\n')
  cat(paste0('### **', abas[i], '**'))
  cat('\n\n<!-- -->\n\n')
  agendas <-
    read_excel("PPG/Agendas de Pesquisa.xlsx",
               sheet = abas[i],
               col_types = c("text"))
  
  cat(
    paste(
      '<iframe src="',
      agendas[1],
      '" style="width:100%; height:600px; border:0;"></iframe>',
      sep = ""
    )
  )
  
  # print end of tab rows
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>

## **Financiadores** {.tabset #financiadores}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **2024-2021**

```{r historico-financiadores-2024, eval = has.financiadores}
# this chunk requires additional data that may  be available
financiadores.raw <-
  read_excel("PPG/Financiadores.xlsx", sheet = "financiadores")

financiadores.sub <-
  financiadores.raw %>% select("Ano",
                               "Agência",
                               "Edital",
                               "Processo No.",
                               "Título do projeto",
                               "Programa")
fonte.sub <- financiadores.raw %>% select("Fonte")

financiadores <-
  financiadores.sub[complete.cases(financiadores.sub), ]
fonte <- fonte.sub[complete.cases(financiadores.sub), ]

fonte <-
  fonte[financiadores$Ano >= 2021 & financiadores$Ano <= 2024, ]
financiadores <-
  financiadores[financiadores$Ano >= 2021 &
                  financiadores$Ano <= 2024, ]

if (dim(financiadores)[1] != 0) {
  Abrir <- matrix(NA, nrow = dim(financiadores)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(fonte)[1])
  {
    if (!is.na(fonte[i, 1]))
    {
      Abrir[i] <-
        paste0('<a href="',
               fonte[i, 1],
               '" target="_blank"',
               '>',
               '↗️' ,
               '</a>')
    }
  }
  financiadores <- cbind(financiadores, Abrir)
  financiadores <-
    financiadores[order(financiadores$Ano, decreasing = TRUE), ]
} else {
  cat('\n\n')
  cat('*Sem dados para exibir*')
  cat('\n\n')
}
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
try(create_dt(financiadores, title = "Ações durante a Pandemia - Financiadores"),
    silent = TRUE)

cat('\n\n')
cat(
  "*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br), [**CNPq**](https://www.gov.br/cnpq/pt-br), [**FAPERJ**](http://www.faperj.br), **UNISUAM**"
)
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2020-2017**

```{r historico-financiadores-2020, eval = has.financiadores}
# this chunk requires additional data that may  be available
financiadores.raw <-
  read_excel("PPG/Financiadores.xlsx", sheet = "financiadores")

financiadores.sub <-
  financiadores.raw %>% select("Ano",
                               "Agência",
                               "Edital",
                               "Processo No.",
                               "Título do projeto",
                               "Programa")
fonte.sub <- financiadores.raw %>% select("Fonte")

financiadores <-
  financiadores.sub[complete.cases(financiadores.sub),]
fonte <- fonte.sub[complete.cases(financiadores.sub),]

fonte <-
  fonte[financiadores$Ano >= 2017 & financiadores$Ano <= 2020,]
financiadores <-
  financiadores[financiadores$Ano >= 2017 &
                  financiadores$Ano <= 2020,]

if (dim(financiadores)[1] != 0) {
  Abrir <- matrix(NA, nrow = dim(financiadores)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(fonte)[1])
  {
    if (!is.na(fonte[i, 1]))
    {
      Abrir[i] <-
        paste0('<a href="',
               fonte[i, 1],
               '" target="_blank"',
               '>',
               '↗️' ,
               '</a>')
    }
  }
  financiadores <- cbind(financiadores, Abrir)
  financiadores <-
    financiadores[order(financiadores$Ano, decreasing = TRUE),]
} else {
  cat('\n\n')
  cat('*Sem dados para exibir*')
  cat('\n\n')
}
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
try(create_dt(financiadores, title = "Ações durante a Pandemia - Financiadores"),
    silent = TRUE)

cat('\n\n')
cat(
  "*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br), [**CNPq**](https://www.gov.br/cnpq/pt-br), [**FAPERJ**](http://www.faperj.br), **UNISUAM**"
)
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2016-2013**

```{r historico-financiadores-2016, eval = has.financiadores}
# this chunk requires additional data that may  be available
financiadores.raw <-
  read_excel("PPG/Financiadores.xlsx", sheet = "financiadores")

financiadores.sub <-
  financiadores.raw %>% select("Ano",
                               "Agência",
                               "Edital",
                               "Processo No.",
                               "Título do projeto",
                               "Programa")
fonte.sub <- financiadores.raw %>% select("Fonte")

financiadores <-
  financiadores.sub[complete.cases(financiadores.sub),]
fonte <- fonte.sub[complete.cases(financiadores.sub),]

fonte <-
  fonte[financiadores$Ano >= 2013 & financiadores$Ano <= 2016,]
financiadores <-
  financiadores[financiadores$Ano >= 2013 &
                  financiadores$Ano <= 2016,]

if (dim(financiadores)[1] != 0) {
  Abrir <- matrix(NA, nrow = dim(financiadores)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(fonte)[1])
  {
    if (!is.na(fonte[i, 1]))
    {
      Abrir[i] <-
        paste0('<a href="',
               fonte[i, 1],
               '" target="_blank"',
               '>',
               '↗️' ,
               '</a>')
    }
  }
  financiadores <- cbind(financiadores, Abrir)
  financiadores <-
    financiadores[order(financiadores$Ano, decreasing = TRUE),]
} else {
  cat('\n\n')
  cat('*Sem dados para exibir*')
  cat('\n\n')
}
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
try(create_dt(financiadores, title = "Ações durante a Pandemia - Financiadores"),
    silent = TRUE)

cat('\n\n')
cat(
  "*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br), [**CNPq**](https://www.gov.br/cnpq/pt-br), [**FAPERJ**](http://www.faperj.br), **UNISUAM**"
)
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2012-2010**

```{r historico-financiadores-2012, eval = has.financiadores}
# this chunk requires additional data that may  be available
financiadores.raw <-
  read_excel("PPG/Financiadores.xlsx", sheet = "financiadores")

financiadores.sub <-
  financiadores.raw %>% select("Ano",
                               "Agência",
                               "Edital",
                               "Processo No.",
                               "Título do projeto",
                               "Programa")
fonte.sub <- financiadores.raw %>% select("Fonte")

financiadores <-
  financiadores.sub[complete.cases(financiadores.sub),]
fonte <- fonte.sub[complete.cases(financiadores.sub),]

fonte <-
  fonte[financiadores$Ano >= 2010 & financiadores$Ano <= 2012,]
financiadores <-
  financiadores[financiadores$Ano >= 2010 &
                  financiadores$Ano <= 2012,]

if (dim(financiadores)[1] != 0) {
  Abrir <- matrix(NA, nrow = dim(financiadores)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(fonte)[1])
  {
    if (!is.na(fonte[i, 1]))
    {
      Abrir[i] <-
        paste0('<a href="',
               fonte[i, 1],
               '" target="_blank"',
               '>',
               '↗️' ,
               '</a>')
    }
  }
  financiadores <- cbind(financiadores, Abrir)
  financiadores <-
    financiadores[order(financiadores$Ano, decreasing = TRUE),]
} else {
  cat('\n\n')
  cat('*Sem dados para exibir*')
  cat('\n\n')
}
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
try(create_dt(financiadores, title = "Ações durante a Pandemia - Financiadores"),
    silent = TRUE)

cat('\n\n')
cat(
  "*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br), [**CNPq**](https://www.gov.br/cnpq/pt-br), [**FAPERJ**](http://www.faperj.br), **UNISUAM**"
)
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Pré-2010**

```{r historico-financiadores-2010, eval = has.financiadores}
# this chunk requires additional data that may  be available
financiadores.raw <-
  read_excel("PPG/Financiadores.xlsx", sheet = "financiadores")

financiadores.sub <-
  financiadores.raw %>% select("Ano",
                               "Agência",
                               "Edital",
                               "Processo No.",
                               "Título do projeto",
                               "Programa")
fonte.sub <- financiadores.raw %>% select("Fonte")

financiadores <-
  financiadores.sub[complete.cases(financiadores.sub),]
fonte <- fonte.sub[complete.cases(financiadores.sub),]

fonte <-
  fonte[financiadores$Ano < 2010,]
financiadores <-
  financiadores[financiadores$Ano < 2010,]

if (dim(financiadores)[1] != 0) {
  Abrir <- matrix(NA, nrow = dim(financiadores)[1])
  colnames(Abrir) <- "Abrir"
  # add hyperlinks
  for (i in 1:dim(fonte)[1])
  {
    if (!is.na(fonte[i, 1]))
    {
      Abrir[i] <-
        paste0('<a href="',
               fonte[i, 1],
               '" target="_blank"',
               '>',
               '↗️' ,
               '</a>')
    }
  }
  financiadores <- cbind(financiadores, Abrir)
  financiadores <-
    financiadores[order(financiadores$Ano, decreasing = TRUE),]
} else {
  cat('\n\n')
  cat('*Sem dados para exibir*')
  cat('\n\n')
}
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
try(create_dt(financiadores, title = "Ações durante a Pandemia - Financiadores"),
    silent = TRUE)

cat('\n\n')
cat(
  "*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br), [**CNPq**](https://www.gov.br/cnpq/pt-br), [**FAPERJ**](http://www.faperj.br), **UNISUAM**"
)
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Bolsas de estudo** {.tabset #bolsas}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **Portarias IES**

```{r bolsas, eval = has.bolsas}
# read separate sheets
turmas.raw <- read_excel("PPG/Bolsas.xlsx", sheet = "PortariaBolsas", col_types = c("text"))

Abrir <- matrix(NA, nrow = dim(turmas.raw)[1])
colnames(Abrir) <- "Abrir"
# add hyperlinks
for(i in 1:dim(turmas.raw)[1]){
  if(!is.na(turmas.raw[i,3])){
    Abrir[i] <- paste0('<a href="', turmas.raw[i,3],'" target="_blank"', '>', "↗️" ,"</a>", sep = "")
  }
}

turmas <- cbind(turmas.raw[,-3], Abrir)
turmas <- turmas[order(turmas$Publicação, decreasing = TRUE), ]

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(turmas, title = "Portarias Bolsas CAPES")

cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Portaria PROSUP**

<br>

<iframe src="http://cad.capes.gov.br/ato-administrativo-detalhar?idAtoAdmElastic=572#anchor" style="width:100%; height:600px; border:0;"></iframe>

<br>

*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br/acesso-a-informacao/acoes-e-programas/bolsas/bolsas-no-pais/programa-de-suporte-a-pos-graduacao-de-instituicoes-de-ensino-particulares-prosup)

<br>

<a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a>

<br>

### **Termo de Compromisso PROSUP**

<br>

<object data="https://www.gov.br/capes/pt-br/centrais-de-conteudo/22102018ModeloTermoCompromissoPROSUP.pdf" type="application/pdf" style="width:100%; height:600px; border:0;">
<div>No online PDF viewer installed</div>
</object>

<br>

*Fontes:* [**CAPES**](https://www.gov.br/capes/pt-br/acesso-a-informacao/acoes-e-programas/bolsas/bolsas-no-pais/programa-de-suporte-a-pos-graduacao-de-instituicoes-de-ensino-particulares-prosup)

<br>

<a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a>

<br>

### **Agradecimento CAPES**

<br>

<iframe src="https://www.in.gov.br/materia/-/asset_publisher/Kujrw0TZC2Mb/content/id/39729251/do1-2018-09-05-portaria-n-206-de-4-de-setembro-de-2018-39729135" style="width:100%; height:600px; border:0;"></iframe>

<br>

*Fontes:* [**Diário Oficial da União**](https://www.in.gov.br/materia/-/asset_publisher/Kujrw0TZC2Mb/content/id/39729251/do1-2018-09-05-portaria-n-206-de-4-de-setembro-de-2018-39729135)

<br>

<a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a>

<br>

## **Cursos** {.tabset #cursos}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **Níveis**

```{r cursos-niveis, eval = has.dados.cadastrais}
# read separate sheets
cursos.raw <- read_excel("PPG/Dados Cadastrais.xlsx", sheet = "Cursos", col_types = c("text"))

cursos <- select(cursos.raw, c("Código", "Curso", "Nível"))

# print tables
print(kable(cursos, align = c("l", rep("c", ncol(cursos)-2), "r")) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Objetivos**

```{r cursos-objetivos, eval = has.dados.cadastrais}
# read separate sheets
cursos.raw <- read_excel("PPG/Dados Cadastrais.xlsx", sheet = "Cursos", col_types = c("text"))

cursos <- select(cursos.raw, c("Nível", "Objetivos"))

# print tables
print(kable(cursos, align = c("l", rep("c", ncol(cursos)-2), "r")) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Créditos**

```{r creditos, eval = has.dados.cadastrais}
# read separate sheets
creditos.raw <- read_excel("PPG/Dados Cadastrais.xlsx", sheet = "Créditos", col_types = c("text"))

# print tables
print(kable(creditos.raw, align = c("l", rep("c", ncol(creditos.raw)-2), "r")) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Calculadora de créditos** {#calculadora-creditos}

```{r calculadora-creditos, eval = has.dados.cadastrais}
dados.do.programa.raw <-
  read_excel("PPG/Dados Cadastrais.xlsx",
             sheet = "Créditos",
             col_types = c("text"))
colnames(dados.do.programa.raw) <-
  seq(1:dim(dados.do.programa.raw)[2])
```

#### **Doutorado** {.tabset}

<center>
  **TOTAL REQUERIDO: `r ifelse(has.dados.cadastrais, dados.do.programa.raw[1,3], "")` CR**
  <br>
  Créditos OBRIGATÓRIOS marcados: <strong id=msgOBRDSC></strong>
  <br>
  Créditos ELETIVOS marcados: <strong id=msgELEDSC></strong>
</center>

##### **Obrigatórios**

<!--script for generating CALCULATOR FORM-->
```{js OBRDSC}
function chkcontrol3(j) {
var sumOBRDSC=0;
for(var i=0; i < document.formOBRDSC.ckb.length; i++){
  if(document.formOBRDSC.ckb[i].checked){
    sumOBRDSC = sumOBRDSC + parseInt(document.formOBRDSC.ckb[i].value);
    }
  document.getElementById("msgOBRDSC").innerHTML= sumOBRDSC + " CR";
  }
}
```

```{r calculadora-doutorado-obrigatorias, eval = has.sucupira}
# disciplinas
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# read separate sheets
disciplinas.raw <- sucupira.list[[format(Sys.Date(), "%Y")]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]
disciplinas.dsc <-
  disciplinas.raw[which(`dim<-`(grepl('Doutorado', disciplinas.raw$`Nível do Curso`), dim(disciplinas.raw$`Nível do Curso`)), arr.ind = TRUE),]

if (length(disciplinas.dsc) != 0) {
  table.dsc <-
    cbind(
      disciplinas.dsc$`Nome da Disciplina`,
      disciplinas.dsc$`Indicadora de disciplina obrigatória`,
      disciplinas.dsc$`Quantidade de créditos`,
      disciplinas.dsc$`Carga Horária`
    )
  colnames(table.dsc) <- c("Disciplina", "Obrigatória", "CR", "CH")
  
  # filtra e exibe apenas as obrigatórias
  table.dsc <- table.dsc[table.dsc[, 2] == "Sim",]
  table.dsc <- table.dsc[complete.cases(table.dsc),]
  table.dsc <- table.dsc[,-2]
  
  cat('<form name=formOBRDSC method=post action=check.php>')
  cat('<table class=\"table table-striped\">')
  for (i in 1:dim(table.dsc)[1]) {
    cat(
      '<tr><td><input type=\"checkbox\" name=\"ckb\" value=\"',
      table.dsc[i, 2],
      '\" onclick=\"chkcontrol3(',
      i - 1,
      ')\">',
      paste0(table.dsc[i, 1], ' (', table.dsc[i, 2], ' CR) (', table.dsc[i, 3]),
      ' CH)',
      '</input></td></tr>'
    )
  }
  cat('</table></form>')
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

##### **Eletivos**

<!--script for generating CALCULATOR FORM-->
```{js ELEDSC}
function chkcontrol4(j) {
var sumELEDSC=0;
for(var i=0; i < document.formELEDSC.ckb.length; i++){
  if(document.formELEDSC.ckb[i].checked){
    sumELEDSC = sumELEDSC + parseInt(document.formELEDSC.ckb[i].value);
    }
  document.getElementById("msgELEDSC").innerHTML= sumELEDSC + " CR";
  }
}
```

```{r calculadora-doutorado-eletivas, eval = has.sucupira}
# disciplinas
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# read separate sheets
disciplinas.raw <- sucupira.list[[format(Sys.Date(), "%Y")]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]
disciplinas.dsc <-
  disciplinas.raw[which(`dim<-`(grepl('Doutorado', disciplinas.raw$`Nível do Curso`), dim(disciplinas.raw$`Nível do Curso`)), arr.ind = TRUE),]

if (length(disciplinas.dsc) != 0) {
  table.dsc <-
    cbind(
      disciplinas.dsc$`Nome da Disciplina`,
      disciplinas.dsc$`Indicadora de disciplina obrigatória`,
      disciplinas.dsc$`Quantidade de créditos`,
      disciplinas.dsc$`Carga Horária`
    )
  colnames(table.dsc) <- c("Disciplina", "Eletiva", "CR", "CH")
  
  # filtra e exibe apenas as obrigatórias
  table.dsc <- table.dsc[table.dsc[, 2] == "Não",]
  table.dsc <- table.dsc[complete.cases(table.dsc),]
  table.dsc <- table.dsc[,-2]
  
  cat('<form name=formELEDSC method=post action=check.php>')
  cat('<table class=\"table table-striped\">')
  for (i in 1:dim(table.dsc)[1]) {
    cat(
      '<tr><td><input type=\"checkbox\" name=\"ckb\" value=\"',
      table.dsc[i, 2],
      '\" onclick=\"chkcontrol4(',
      i - 1,
      ')\">',
      paste0(table.dsc[i, 1], ' (', table.dsc[i, 2], ' CR) (', table.dsc[i, 3]),
      ' CH)',
      '</input></td></tr>'
    )
  }
  cat('</table></form>')
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

#### **Mestrado** {.tabset}

<center>
  **TOTAL REQUERIDO: `r ifelse(has.dados.cadastrais, dados.do.programa.raw[1,2], "")` CR**
  <br>
  Créditos OBRIGATÓRIOS marcados: <strong id=msgOBRMSC></strong>
  <br>
  Créditos ELETIVOS marcados: <strong id=msgELEMSC></strong>
</center>

##### **Obrigatórios**

<!--script for generating CALCULATOR FORM-->
```{js OBRMSC}
function chkcontrol1(j) {
var sumOBRMSC=0;
for(var i=0; i < document.formOBRMSC.ckb.length; i++){
  if(document.formOBRMSC.ckb[i].checked){
    sumOBRMSC = sumOBRMSC + parseInt(document.formOBRMSC.ckb[i].value);
    }
  document.getElementById("msgOBRMSC").innerHTML= sumOBRMSC + " CR";
  }
}
```

```{r calculadora-mestrado-obrigatorias, eval = has.sucupira}
# disciplinas
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# read separate sheets
disciplinas.raw <- sucupira.list[[format(Sys.Date(), "%Y")]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]
disciplinas.msc <-
  disciplinas.raw[which(`dim<-`(grepl('Mestrado', disciplinas.raw$`Nível do Curso`), dim(disciplinas.raw$`Nível do Curso`)), arr.ind = TRUE),]

if (length(disciplinas.msc) != 0) {
  table.msc <-
    cbind(
      disciplinas.msc$`Nome da Disciplina`,
      disciplinas.msc$`Indicadora de disciplina obrigatória`,
      disciplinas.msc$`Quantidade de créditos`,
      disciplinas.msc$`Carga Horária`
    )
  colnames(table.msc) <- c("Disciplina", "Obrigatória", "CR", "CH")
  
  # filtra e exibe apenas as obrigatórias
  table.msc <- table.msc[table.msc[, 2] == "Sim",]
  table.msc <- table.msc[complete.cases(table.msc),]
  table.msc <- table.msc[,-2]
  
  cat('<form name=formOBRMSC method=post action=check.php>')
  cat('<table class=\"table table-striped\">')
  for (i in 1:dim(table.msc)[1]) {
    cat(
      '<tr><td><input type=\"checkbox\" name=\"ckb\" value=\"',
      table.msc[i, 2],
      '\" onclick=\"chkcontrol1(',
      i - 1,
      ')\">',
      paste0(table.msc[i, 1], ' (', table.msc[i, 2], ' CR) (', table.msc[i, 3]),
      ' CH)',
      '</input></td></tr>'
    )
  }
  cat('</table></form>')
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

##### **Eletivos**

<!--script for generating CALCULATOR FORM-->
```{js ELEMSC}
function chkcontrol2(j) {
var sumELEMSC=0;
for(var i=0; i < document.formELEMSC.ckb.length; i++){
  if(document.formELEMSC.ckb[i].checked){
    sumELEMSC = sumELEMSC + parseInt(document.formELEMSC.ckb[i].value);
    }
  document.getElementById("msgELEMSC").innerHTML= sumELEMSC + " CR";
  }
}
```

```{r calculadora-mestrado-eletivas, eval = has.sucupira}
# projetos
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# read separate sheets
disciplinas.raw <- sucupira.list[[format(Sys.Date(), "%Y")]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]
disciplinas.msc <-
  disciplinas.raw[which(`dim<-`(grepl('Mestrado', disciplinas.raw$`Nível do Curso`), dim(disciplinas.raw$`Nível do Curso`)), arr.ind = TRUE),]

if (length(disciplinas.msc) != 0) {
  table.msc <-
    cbind(
      disciplinas.msc$`Nome da Disciplina`,
      disciplinas.msc$`Indicadora de disciplina obrigatória`,
      disciplinas.msc$`Quantidade de créditos`,
      disciplinas.msc$`Carga Horária`
    )
  colnames(table.msc) <- c("Disciplina", "Eletiva", "CR", "CH")
  
  # filtra e exibe apenas as obrigatórias
  table.msc <- table.msc[table.msc[, 2] == "Não",]
  table.msc <- table.msc[complete.cases(table.msc),]
  table.msc <- table.msc[,-2]
  
  cat('<form name=formELEMSC method=post action=check.php>')
  cat('<table class=\"table table-striped\">')
  for (i in 1:dim(table.msc)[1]) {
    cat(
      '<tr><td><input type=\"checkbox\" name=\"ckb\" value=\"',
      table.msc[i, 2],
      '\" onclick=\"chkcontrol2(',
      i - 1,
      ')\">',
      paste0(table.msc[i, 1], ' (', table.msc[i, 2], ' CR) (', table.msc[i, 3]),
      ' CH)',
      '</input></td></tr>'
    )
  }
  cat('</table></form>')
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Estrutura curricular** {.tabset #estrutura-curricular}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **Síntese**

```{r estrutura-academica-atual-grafico, eval = has.sucupira}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# projetos
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# most recent Sucupira year
most.recent <-
  as.character(ifelse(!is.null(sucupira.list[[format(Sys.Date(), "%Y")]]), format(Sys.Date(), "%Y"), max(as.numeric(
    names(sucupira.list)
  ))))

# read separate sheets
disciplinas.raw <- sucupira.list[[most.recent]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]

# select level
course.level <- "Mestrado"
disciplinas.msc <-
  disciplinas.raw[str_detect(disciplinas.raw$`Nível do Curso`, course.level),]

table.msc <-
  cbind(
    disciplinas.msc$`Nome da Disciplina`,
    disciplinas.msc$`Indicadora de disciplina obrigatória`,
    disciplinas.msc$`Quantidade de créditos`,
    disciplinas.msc$`Carga Horária`
  )
try(colnames(table.msc) <-
      c("Disciplina", "Obrigatória", "CR", "CH"),
    silent = TRUE)

# select level
course.level <- "Doutorado"
disciplinas.dsc <-
  disciplinas.raw[str_detect(disciplinas.raw$`Nível do Curso`, course.level),]
table.dsc <-
  cbind(
    disciplinas.dsc$`Nome da Disciplina`,
    disciplinas.dsc$`Indicadora de disciplina obrigatória`,
    disciplinas.dsc$`Quantidade de créditos`,
    disciplinas.dsc$`Carga Horária`
  )
try(colnames(table.dsc) <-
      c("Disciplina", "Obrigatória", "CR", "CH"),
    silent = TRUE
)

table <-
  merge(table.msc,
        table.dsc,
        by = "Disciplina",
        all.x = TRUE,
        all.y = TRUE)
try(colnames(table) <-
      c(
        "Disciplina",
        "Obrigatória (MA)",
        "CR (MA)",
        "CH (MA)",
        "Obrigatória (DA)",
        "CR (DA)",
        "CH (DA)"
      ),
    silent = TRUE)

# print tables
# kable(table)

# line break
# cat("  \n")
# cat("  \n")

if(!is.null(table)) {
  layout(matrix(
    c(1, 2, 3, 3),
    nrow = 2,
    ncol = 2,
    byrow = TRUE
  ), heights = c(0.7, 0.3))
  par(oma = c(0.1, 0.1, 2, 0.1), mar = c(1, 1, 1, 1))
  # generate plot of total per course
  pie(
    table(table.msc[, which(colnames(table.msc) == "Obrigatória")]),
    labels = NA,
    col = brewer.pal(n = min(unique(
      colnames(table.msc)
    ), 3), name = "Set3"),
    init.angle = 90,
    main = "Mestrado"
  )
  pie(
    table(table.dsc[, which(colnames(table.dsc) == "Obrigatória")]),
    labels = NA,
    col = brewer.pal(n = min(unique(
      colnames(table.dsc)
    ), 3), name = "Set3"),
    init.angle = 90,
    main = "Doutorado"
  )
  plot(0, type = 'n', axes = FALSE)
  obrigatoria <-
    unique(disciplinas.raw$`Indicadora de disciplina obrigatória`)
  obrigatoria[which(obrigatoria == "Sim")] <- "Obrigatória"
  obrigatoria[which(obrigatoria == "Não")] <- "Eletiva"
  legend(
    "center",
    legend = obrigatoria,
    fill = brewer.pal(n = length(obrigatoria), name = "Set3"),
    box.lwd = 0,
    cex = 1
  )
} else {
  cat("*Sem dados para exibir*")
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Ementas**

```{r ementas, eval = has.bibliografia}
# read separate sheets
bibliografia.raw <-
  read_excel("PPG/Bibliografia.xlsx",
             sheet = "Ementas",
             col_types = c("text"))
link_ementas <- bibliografia.raw[, 3]

cat(
  '<iframe src=\"',
  as.character(link_ementas),
  '/preview" style=\"width:100%; height:500px; border:0;\"></iframe>',
  sep = ""
)

cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Disciplinas**

```{r estrutura-academica-atual-tabela, eval = has.sucupira}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# projetos
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# most recent Sucupira year
most.recent <-
  as.character(ifelse(!is.null(sucupira.list[[format(Sys.Date(), "%Y")]]), format(Sys.Date(), "%Y"), max(as.numeric(
    names(sucupira.list)
  ))))

# read separate sheets
disciplinas.raw <- sucupira.list[[most.recent]]
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]

# select level
course.level <- "Mestrado"
disciplinas.msc <-
  disciplinas.raw[str_detect(disciplinas.raw$`Nível do Curso`, course.level), ]
table.msc <- cbind(disciplinas.msc$`Nome da Disciplina`, disciplinas.msc$`Indicadora de disciplina obrigatória`, disciplinas.msc$`Quantidade de créditos`, disciplinas.msc$`Carga Horária`)
colnames(table.msc) <- c("Disciplina", "Obrigatória", "CR", "CH")

# select level
course.level <- "Doutorado"
disciplinas.dsc <-
  disciplinas.raw[str_detect(disciplinas.raw$`Nível do Curso`, course.level), ]
table.dsc <- cbind(disciplinas.dsc$`Nome da Disciplina`, disciplinas.dsc$`Indicadora de disciplina obrigatória`, disciplinas.dsc$`Quantidade de créditos`, disciplinas.dsc$`Carga Horária`)
colnames(table.dsc) <- c("Disciplina", "Obrigatória", "CR", "CH")

table <- merge(table.msc, table.dsc, by="Disciplina", all.x = TRUE, all.y = TRUE)
colnames(table) <- c("Disciplina", "Obrigatória (MA)", "CR (MA)", "CH (MA)", "Obrigatória (DA)", "CR (DA)", "CH (DA)")

# print tables
print(kable(table, align = c("l", rep("c", ncol(table)-2), "r")) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Bibliografia**

```{r bibliografia, eval = has.bibliografia}
# read separate sheets
bibliografia.raw <- read_excel("PPG/Bibliografia.xlsx", sheet = "Bibliografia", col_types = c("text"))

source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(bibliografia.raw, title = "Bibliografia")

cat('<br>')
```

```{r bibliografia-ano, eval = has.bibliografia}
# read separate sheets
bibliografia.raw <- read_excel("PPG/Bibliografia.xlsx", sheet = "Bibliografia", col_types = c("text"))

bib.ano.raw <- bibliografia.raw$Referência
bib.ano <- as.numeric(na.exclude(str_extract(bib.ano.raw, "[' '][2-2][0-9][0-9][0-9]")))
bib.ano <- as.numeric(na.exclude(str_extract(bib.ano.raw, "[' '][1-1][9-9][5-9][0-9]|[2-2][0-0][0-2][0-1]")))

par(oma=c(2, 0.1, 2, 0.1), mar = c(5, 4, 2, 2))
# generate plot of conceitos per year
hist(bib.ano, xlab = "Ano de publicação", ylab = "Referências (N)", col = brewer.pal(n = 3, name = "Set3")[1], main = NULL)
title("Referências bibliográficas, por ano de publicação", outer = TRUE)

cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Inativas**

```{r estrutura-academica-inativa, eval = has.sucupira}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# disciplinas
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

disciplinas.raw <- sucupira.raw
disciplinas.raw <- disciplinas.raw[!is.na(disciplinas.raw$`Data de fim`), ]

disciplinas.msc <-
  disciplinas.raw[which(`dim<-`(grepl('Mestrado', disciplinas.raw$`Nível do Curso`), dim(disciplinas.raw$`Nível do Curso`)), arr.ind = TRUE),]
table.msc <- cbind(disciplinas.msc$`Nome da Disciplina`, disciplinas.msc$`Indicadora de disciplina obrigatória`, disciplinas.msc$`Quantidade de créditos`, disciplinas.msc$`Carga Horária`, disciplinas.msc$`Data de fim`)
colnames(table.msc) <- c("Disciplina", "Obrigatória", "CR", "CH", "Fim")

disciplinas.dsc <-
  disciplinas.raw[which(`dim<-`(grepl('Doutorado', disciplinas.raw$`Nível do Curso`), dim(disciplinas.raw$`Nível do Curso`)), arr.ind = TRUE),]
table.dsc <- cbind(disciplinas.dsc$`Nome da Disciplina`, disciplinas.dsc$`Indicadora de disciplina obrigatória`, disciplinas.dsc$`Quantidade de créditos`, disciplinas.dsc$`Carga Horária`, disciplinas.dsc$`Data de fim`)
colnames(table.dsc) <- c("Disciplina", "Obrigatória", "CR", "CH", "Fim")

table <- merge(table.msc, table.dsc, by="Disciplina", all.x = TRUE, all.y = TRUE)
colnames(table) <- c("Disciplina", "Obrigatória (MA)", "CR (MA)", "CH (MA)", "Fim", "Obrigatória (DA)", "CR (DA)", "CH (DA)", "Fim")

# print tables
print(kable(unique(table), row.names = FALSE, align = c("l", rep("c", ncol(table)-2), "r")) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = T, position = "center"))

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Turmas** {.tabset #turmas}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **Síntese**

```{r turmas-tabela, eval = has.sucupira}
# turmas
sheet <- "Turmas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

turmas.raw <- sucupira.raw

# build a cross table DISCIPLINA vs. ANO
turmas.raw <-
  turmas.raw[turmas.raw$`Indicador de responsável principal` == "Sim", ]
turmas.raw$`Período/Ano` <-
  paste(
    sub(".*/", "", turmas.raw$`Período/Ano`),
    sub("/.*", "", turmas.raw$`Período/Ano`),
    sep = "/"
  )
cross.table.turmas <-
  as.matrix(table(turmas.raw$`Nível do curso`, turmas.raw$`Período/Ano`))

# generate plot of total per year
par(
  oma = c(2, 0.1, 2, 0.1),
  mar = c(5, 4, 2, 2),
  bg = '#2C3E50',
  col.lab = "white",
  col.axis = "white",
  fg = "white",
  col.main = "white"
)
# generate plot of turmas per year
barplot(
  cross.table.turmas,
  las = 2,
  ylab = "Turmas",
  main = "Quantidade de turmas",
  col = c("darkblue", "lightblue"),
  beside = TRUE,
  bty = "n"
)
legend(
  "topleft",
  legend = levels(as.factor(turmas.raw$`Nível do curso`)),
  fill = c("darkblue", "lightblue"),
  box.lty = 0
)

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Docentes**

```{r turmas-docentes-2024, eval = has.sucupira}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# disciplinas
sheet <- "Disciplinas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# bind all sheets
periodos <-
  names(sucupira.list)[na.omit(match(c(2021:2024), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
disciplinas.raw <-
  do.call(rbind.data.frame, sucupira.list[periodos])
disciplinas.raw <-
  disciplinas.raw[is.na(disciplinas.raw$`Data de fim`),]

# turmas
sheet <- "Turmas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# bind all sheets
periodos <-
  names(sucupira.list)[na.omit(match(c(2021:2024), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
turmas.raw <- do.call(rbind.data.frame, sucupira.list[periodos])

if (dim(disciplinas.raw)[1] != 0) {
  # select level
  course.level <- "Mestrado"
  disciplinas.msc <-
    disciplinas.raw[str_detect(disciplinas.raw$`Nível do Curso`, course.level), ]
  
  disciplinas.msc <-
    disciplinas.raw[course.level,]
  table.msc <-
    cbind(
      disciplinas.msc$`Nome da Disciplina`,
      disciplinas.msc$`Indicadora de disciplina obrigatória`,
      disciplinas.msc$`Quantidade de créditos`,
      disciplinas.msc$`Carga Horária`
    )
  colnames(table.msc) <- c("Disciplina", "Obrigatória", "CR", "CH")
  
  course.level <- "Doutorado"
  disciplinas.dsc <-
    disciplinas.raw[str_detect(disciplinas.raw$`Nível do Curso`, course.level), ]
  disciplinas.dsc <-
    disciplinas.raw[course.level,]
  table.dsc <-
    cbind(
      disciplinas.dsc$`Nome da Disciplina`,
      disciplinas.dsc$`Indicadora de disciplina obrigatória`,
      disciplinas.dsc$`Quantidade de créditos`,
      disciplinas.dsc$`Carga Horária`
    )
  colnames(table.dsc) <- c("Disciplina", "Obrigatória", "CR", "CH")
  
  table <-
    merge(
      table.msc,
      table.dsc,
      by = "Disciplina",
      all.x = TRUE,
      all.y = TRUE
    )
  colnames(table) <-
    c(
      "Disciplina",
      "Obrigatória (MA)",
      "CR (MA)",
      "CH (MA)",
      "Obrigatória (DA)",
      "CR (DA)",
      "CH (DA)"
    )
  
  # build a cross table DISCIPLINA vs. DOCENTE
  cross.table.turmas <-
    as.matrix(table(
      initials(turmas.raw$`Nome da Disciplina`),
      initials(turmas.raw$`Nome do responsável`)
    ))
  Responsável <- colSums(cross.table.turmas)
  Responsável[Responsável > 0] <- "✅"
  Responsável[Responsável == 0] <- ""
  turmas.docentes <- rbind(Responsável, cross.table.turmas)
  turmas.docentes[turmas.docentes > 0] <- "✔"
  turmas.docentes[turmas.docentes == 0] <- ""
  print(
    kable(turmas.docentes, align = c("l", rep(
      "c", ncol(turmas.docentes) - 2
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.turma <-
    unique(cbind(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Nome da Disciplina`
    ))
  legenda.turma <- legenda.turma[order(legenda.turma[, 1]),]
  cat(paste(
    "*",
    legenda.turma[, 1],
    ": ",
    lapply(legenda.turma[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.doc <-
    unique(cbind(
      initials(turmas.raw$`Nome do responsável`),
      turmas.raw$`Nome do responsável`
    ))
  legenda.doc <- legenda.doc[order(legenda.doc[, 1]),]
  cat(paste(
    "*",
    legenda.doc[, 1],
    ": ",
    lapply(legenda.doc[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2024-2021**

```{r turmas-2024, eval = has.sucupira}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# turmas
sheet <- "Turmas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# bind all sheets
periodos <-
  names(sucupira.list)[na.omit(match(c(2021:2024), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
turmas.raw <- do.call(rbind.data.frame, sucupira.list[periodos])

if (dim(turmas.raw)[1] != 0) {
  # build a cross table DISCIPLINA vs. ANO
  turmas.raw$`Período/Ano` <-
    paste(
      sub(".*/", "", turmas.raw$`Período/Ano`),
      sub("/.*", "", turmas.raw$`Período/Ano`),
      sep = "/"
    )
  cross.table.turmas <-
    as.matrix(table(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Período/Ano`
    ))
  Oferecida <- colSums(cross.table.turmas)
  Oferecida[Oferecida > 0] <- "✅"
  Oferecida[Oferecida == 0] <- ""
  turmas.oferecidas <- rbind(Oferecida, cross.table.turmas)
  turmas.oferecidas[turmas.oferecidas > 0] <- "✔"
  turmas.oferecidas[turmas.oferecidas == 0] <- ""
  if (length(colnames(turmas.oferecidas)) > 1) {
    turmas.oferecidas <-
      turmas.oferecidas[, order(colnames(turmas.oferecidas), decreasing = TRUE)]
  }
  print(
    kable(turmas.oferecidas, align = c("l", rep(
      "c",  max(0, ncol(turmas.oferecidas) - 2)
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.turma <-
    unique(cbind(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Nome da Disciplina`
    ))
  legenda.turma <- legenda.turma[order(legenda.turma[, 1]),]
  cat(paste(
    "*",
    legenda.turma[, 1],
    ": ",
    lapply(legenda.turma[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.doc <-
    unique(cbind(
      initials(turmas.raw$`Nome do responsável`),
      turmas.raw$`Nome do responsável`
    ))
  legenda.doc <- legenda.doc[order(legenda.doc[, 1]),]
  cat(paste(
    "*",
    legenda.doc[, 1],
    ": ",
    lapply(legenda.doc[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2020-2017**

```{r turmas-2020, eval = has.sucupira}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# turmas
sheet <- "Turmas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# bind all sheets
periodos <-
  names(sucupira.list)[na.omit(match(c(2017:2020), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
turmas.raw <- do.call(rbind.data.frame, sucupira.list[periodos])

if (dim(turmas.raw)[1] != 0) {
  # build a cross table DISCIPLINA vs. ANO
  turmas.raw$`Período/Ano` <-
    paste(
      sub(".*/", "", turmas.raw$`Período/Ano`),
      sub("/.*", "", turmas.raw$`Período/Ano`),
      sep = "/"
    )
  cross.table.turmas <-
    as.matrix(table(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Período/Ano`
    ))
  Oferecida <- colSums(cross.table.turmas)
  Oferecida[Oferecida > 0] <- "✅"
  Oferecida[Oferecida == 0] <- ""
  turmas.oferecidas <- rbind(Oferecida, cross.table.turmas)
  turmas.oferecidas[turmas.oferecidas > 0] <- "✔"
  turmas.oferecidas[turmas.oferecidas == 0] <- ""
  if (length(colnames(turmas.oferecidas)) > 1) {
    turmas.oferecidas <-
      turmas.oferecidas[, order(colnames(turmas.oferecidas), decreasing = TRUE)]
  }
  print(
    kable(turmas.oferecidas, align = c("l", rep(
      "c", ncol(turmas.oferecidas) - 2
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.turma <-
    unique(cbind(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Nome da Disciplina`
    ))
  legenda.turma <- legenda.turma[order(legenda.turma[, 1]),]
  cat(paste(
    "*",
    legenda.turma[, 1],
    ": ",
    lapply(legenda.turma[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2016-2013**

```{r turmas-2016, eval = has.sucupira}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# turmas
sheet <- "Turmas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# bind all sheets
periodos <-
  names(sucupira.list)[na.omit(match(c(2013:2016), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
turmas.raw <- do.call(rbind.data.frame, sucupira.list[periodos])

if (dim(turmas.raw)[1] != 0) {
  # build a cross table DISCIPLINA vs. ANO
  turmas.raw$`Período/Ano` <-
    paste(
      sub(".*/", "", turmas.raw$`Período/Ano`),
      sub("/.*", "", turmas.raw$`Período/Ano`),
      sep = "/"
    )
  cross.table.turmas <-
    as.matrix(table(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Período/Ano`
    ))
  Oferecida <- colSums(cross.table.turmas)
  Oferecida[Oferecida > 0] <- "✅"
  Oferecida[Oferecida == 0] <- ""
  turmas.oferecidas <- rbind(Oferecida, cross.table.turmas)
  turmas.oferecidas[turmas.oferecidas > 0] <- "✔"
  turmas.oferecidas[turmas.oferecidas == 0] <- ""
  if (length(colnames(turmas.oferecidas)) > 1) {
    turmas.oferecidas <-
      turmas.oferecidas[, order(colnames(turmas.oferecidas), decreasing = TRUE)]
  }
  print(
    kable(turmas.oferecidas, align = c("l", rep(
      "c", ncol(turmas.oferecidas) - 2
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.turma <-
    unique(cbind(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Nome da Disciplina`
    ))
  legenda.turma <- legenda.turma[order(legenda.turma[, 1]),]
  cat(paste(
    "*",
    legenda.turma[, 1],
    ": ",
    lapply(legenda.turma[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **2012-2010**

```{r turmas-2012, eval = has.sucupira}
# load custom function
source("Scripts/get-initials.R", local = knitr::knit_global())

# turmas
sheet <- "Turmas"
source("Scripts/read-xlsx-sucupira.R", local = knitr::knit_global())

# get years
source("Scripts/years-sucupira.R", local = knitr::knit_global())
names(sucupira.list) <- as.character(anos)

# bind all sheets
periodos <-
  names(sucupira.list)[na.omit(match(c(2010:2012), names(sucupira.list)))]
periodo <- as.character(seq(min(periodos), max(periodos)))
turmas.raw <- do.call(rbind.data.frame, sucupira.list[periodos])

if (dim(turmas.raw)[1] != 0) {
  # build a cross table DISCIPLINA vs. ANO
  turmas.raw$`Período/Ano` <-
    paste(
      sub(".*/", "", turmas.raw$`Período/Ano`),
      sub("/.*", "", turmas.raw$`Período/Ano`),
      sep = "/"
    )
  cross.table.turmas <-
    as.matrix(table(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Período/Ano`
    ))
  Oferecida <- colSums(cross.table.turmas)
  Oferecida[Oferecida > 0] <- "✅"
  Oferecida[Oferecida == 0] <- ""
  turmas.oferecidas <- rbind(Oferecida, cross.table.turmas)
  turmas.oferecidas[turmas.oferecidas > 0] <- "✔"
  turmas.oferecidas[turmas.oferecidas == 0] <- ""
  if (length(colnames(turmas.oferecidas)) > 1) {
    turmas.oferecidas <-
      turmas.oferecidas[, order(colnames(turmas.oferecidas), decreasing = TRUE)]
  }
  print(
    kable(turmas.oferecidas, align = c("l", rep(
      "c", ncol(turmas.oferecidas) - 2
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
  
  # line break
  cat("  \n")
  cat("  \n")
  
  legenda.turma <-
    unique(cbind(
      initials(turmas.raw$`Nome da Disciplina`),
      turmas.raw$`Nome da Disciplina`
    ))
  legenda.turma <- legenda.turma[order(legenda.turma[, 1]),]
  cat(paste(
    "*",
    legenda.turma[, 1],
    ": ",
    lapply(legenda.turma[, 2], str_to_title),
    "*",
    sep = "",
    collapse = "; "
  ))
}

cat('\n\n')
cat('*Fontes:* [**Plataforma Sucupira**](https://sucupira.capes.gov.br/sucupira/)')
cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Calendários** {#calendarios}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **Sede**

```{r calendarios-sede, eval = has.calendarios}
# read separate sheets
turmas.raw <- read_excel("PPG/Calendários.xlsx", sheet = "Sede", col_types = c("text"))

Abrir <- matrix(NA, nrow = dim(turmas.raw)[1])
colnames(Abrir) <- "Abrir"
# add hyperlinks
for(i in 1:dim(turmas.raw)[1]){
  if(!is.na(turmas.raw[i,3])){
    Abrir[i] <- paste0('<a href="', turmas.raw[i,3],'" target="_blank"', '>', "↗️" ,"</a>", sep = "")
  }
}

turmas <- cbind(turmas.raw[,-3], Abrir)
turmas <- turmas[order(turmas$Publicação, decreasing = TRUE), ]

# print table
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(turmas, title = "Calendários")

cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

### **Cooperação Interinstitucional**

```{r calendarios-cooperacao, eval = has.calendarios}
# read separate sheets
turmas.raw <- read_excel("PPG/Calendários.xlsx", sheet = "Cooperação", col_types = c("text"))

Abrir <- matrix(NA, nrow = dim(turmas.raw)[1])
colnames(Abrir) <- "Abrir"
# add hyperlinks
for(i in 1:dim(turmas.raw)[1]){
  if(!is.na(turmas.raw[i,3])){
    Abrir[i] <- paste0('<a href="', turmas.raw[i,3],'" target="_blank"', '>', "↗️" ,"</a>", sep = "")
  }
}

turmas <- cbind(turmas.raw[,-3], Abrir)
turmas <- turmas[order(turmas$Publicação, decreasing = TRUE), ]

# print table
source("Scripts/table-with-buttons.R", local = knitr::knit_global())
create_dt(turmas, title = "Calendários")

cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

<br>

## **Infraestrutura** {.tabset #infraestrutura}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

### **Laboratórios**

```{r laboratorios-descritivo, eval = has.laboratorios}
# read separate sheets
dados.lab <- read_excel("PPG/Laboratórios.xlsx", sheet = "Dados")

# print tables
print(
  kable(dados.lab, digits = 0, align = c("l", rep(
    "c", ncol(dados.lab) - 2
  ), "r")) %>% kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = T,
    position = "center"
  )
)

cat('\n\n')
cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
```

```{r laboratorios-equipamentos, eval = has.laboratorios}
# read data
labs <-
  read_excel("PPG/Laboratórios.xlsx",
             sheet = "Dados",
             col_types = c("text"))

for (i in 1:dim(labs)[1]) {
  lab <-
    read_excel("PPG/Laboratórios.xlsx",
               sheet = paste("Lab", i, sep = ""))
  name <- names(lab[1])
  
  cat('\n\n<!-- -->\n\n')
  name <- names(lab[1])
  colnames(lab) <- lab[1, ]
  
  cat('\n\n<!-- -->\n\n')
  cat("### **", paste("Lab. ", i, sep = ""), "**", "\n", sep = "")
  cat('\n\n<!-- -->\n\n')
  cat('<center>\n')
  cat("**", name, "**", sep = "")
  cat('\n\n<!-- -->\n\n')
  cat('\n</center>')
  
  cat('<div class = "row"><div class = "col-md-6">')
  cat('<center>\n')
  cat('\n\n<!-- -->\n\n')
  lab <- lab[-1,]
  cat(paste0("![](", getwd(), "/PPG/Labs/Lab-", i, ".jpg)"), "\n")
  cat('\n\n<!-- -->\n\n')
  cat('\n</center>')
  cat('</div>')
  
  cat('<div class = "col-md-6">')
  cat('<center>\n')
  cat('\n\n<!-- -->\n\n')
  print(
    kable(lab, digits = 0, align = c("l", rep("c", ncol(
      lab
    ) - 2), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )  %>% scroll_box(width = "100%", height = "250px")
  )
  cat('\n</center>')
  cat('</div></div>')
  
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>

## **Convênios institucionais** {.tabset #convenios}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

```{r programa-convenios, eval = has.convenios}
# initialize all sheets
abas <- excel_sheets("PPG/Convênios.xlsx")

# display each sheet in a tab
for (i in 1:length(abas)) {
  cat('\n\n<!-- -->\n\n')
  cat(paste0('### **', abas[i], '**'))
  cat('\n\n<!-- -->\n\n')
  convenios.raw <-
    read_excel("PPG/Convênios.xlsx",
               sheet = abas[i],
               col_types = c("text"))
  
  # replace the link by a tag
  for (i in 1:dim(convenios.raw)[1]) {
    convenios.raw[i, 3] <-
      paste("[↗️](", convenios.raw[i, 3], '){target="_blank"}', sep = "")
  }
  
  # print table
  print(
    kable(convenios.raw, align = c("l", rep(
      "c", ncol(convenios.raw) - 2
    ), "r")) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
  
  # print end of tab rows
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}

cat('<br>')
```

<br>

## **Cooperação entre instituições** {#cooperacao}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

```{r programa-cooperacao, eval = has.cooperacoes}
# initialize all sheets
abas <- excel_sheets("PPG/Cooperações.xlsx")

# display each sheet in a tab
for (i in 1:length(abas)) {
  cat('\n\n<!-- -->\n\n')
  cat(paste0('### **', abas[i], '**'))
  cat('\n\n<!-- -->\n\n')
  historico.raw <-
    read_excel("PPG/Cooperações.xlsx",
               sheet = abas[i],
               col_types = c("text"))
  
  # print table
  print(
    kable(historico.raw, align = "l", col.names = NULL) %>% kable_styling(
      bootstrap_options = c("striped", "hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
  
  # print end of tab rows
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>

## **Internacionalização** {.tabset #internacional}

<!--script for generating HORIZONTAL LINE-->
<hr style="height:2px;border-width:0;color:#2C3E50;background-color:#2C3E50">

```{r internacional, eval = has.internacionalizacao}
# read separate sheets
file.path <- "PPG/Internacionalização.xlsx"
tabs <- excel_sheets(file.path)
topics <- c()
news.list <- vector(mode = "list", length = length(tabs))

# iterate across sheets
for (j in 1:length(tabs)) {
  news <-
    read_excel(file.path,
               sheet = tabs[j],
               col_types = c("text", "text", "text"))
  # replace the link by a tag
  for (i in 1:dim(news)[1]) {
    news[i, 1] <-
      paste("### **", as.character(as.Date(as.numeric(news[i, 1]), origin = "1899-12-30")), "**", sep = "")
    news[i, 3] <-
      paste("[↗️](", news[i, 3], '){target="_blank"}', sep = "")
  }
  
  # drop date column
  news <- news[,-1]
  # store data to print table
  news.list[[j]] <- news
  
  # store data to plot wordcloud
  topics <- rbind(topics, news[i, 1])
}

# iterate across sheets
for (j in 1:length(tabs)) {
  cat('\n\n<!-- -->\n\n')
  cat("### **", tabs[j], "**", "\n", sep = "")
  cat('\n\n<!-- -->\n\n')
  print(
    kable(news.list[[j]], align = c("l", rep("c", ncol(
      news
    ) - 2), "r")) %>% kable_styling(
      bootstrap_options = c("hover", "condensed", "responsive"),
      full_width = T,
      position = "center"
    )
  )
  cat('\n\n<!-- -->\n\n')
  cat('<br><a style="float:right" href="#top"><b>Início &nbsp;</b>⬆️</a><br>')
}
```

<br>
